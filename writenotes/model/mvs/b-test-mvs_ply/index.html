<!DOCTYPE html>
<html lang="en-us" dir="ltr">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content='(Feature image is from: CasMVSNet_pl)
Restoring point cloud: Fuse depth maps of multi-views, and then unproject the depth map to 3D points.
MVSNet-PyTorch Source code: MVSNet-PyTorch
Download pretrained model checkpoint
1 gdown 1j2I_LNKb9JeCl6wdA7hh8z1WgVQZfLU9 -O ./checkpoints/pretrained/MVSNet-Pytorch_model_000014.ckpt Download preprocessed testing data of MVSNet
1 2 gdown 135oKPefcPTsdtLRzoDAQtPpHuoIrpRI_ -O /data2/zichen/MVSNet_testing_dtu.zip unzip /data2/zichen/MVSNet_testing_dtu.zip -d /data2/zichen/MVSNet_testing Modify data paths in eval.sh, and uncomment the line#302: save_depth() in &amp;ldquo;eval.py&amp;rdquo; to generate depth map first. And then run the script: .'>
<title>test: Points - MVSNets | Restore Point Cloud from Depth Map</title>

<link rel='canonical' href='https://zichen34.github.io/writenotes/model/mvs/b-test-mvs_ply/'>

<link rel="stylesheet" href="/scss/style.min.8191399262444ab68b72a18c97392f5349be20a1615d77445be51e974c144cff.css"><meta property='og:title' content='test: Points - MVSNets | Restore Point Cloud from Depth Map'>
<meta property='og:description' content='(Feature image is from: CasMVSNet_pl)
Restoring point cloud: Fuse depth maps of multi-views, and then unproject the depth map to 3D points.
MVSNet-PyTorch Source code: MVSNet-PyTorch
Download pretrained model checkpoint
1 gdown 1j2I_LNKb9JeCl6wdA7hh8z1WgVQZfLU9 -O ./checkpoints/pretrained/MVSNet-Pytorch_model_000014.ckpt Download preprocessed testing data of MVSNet
1 2 gdown 135oKPefcPTsdtLRzoDAQtPpHuoIrpRI_ -O /data2/zichen/MVSNet_testing_dtu.zip unzip /data2/zichen/MVSNet_testing_dtu.zip -d /data2/zichen/MVSNet_testing Modify data paths in eval.sh, and uncomment the line#302: save_depth() in &amp;ldquo;eval.py&amp;rdquo; to generate depth map first. And then run the script: .'>
<meta property='og:url' content='https://zichen34.github.io/writenotes/model/mvs/b-test-mvs_ply/'>
<meta property='og:site_name' content='Zichen Wang'>
<meta property='og:type' content='article'><meta property='article:section' content='WriteNotes' /><meta property='article:tag' content='MVG' /><meta property='article:tag' content='Points' /><meta property='article:published_time' content='2024-02-21T09:00:00&#43;00:00'/><meta property='article:modified_time' content='2024-02-21T09:00:00&#43;00:00'/><meta property='og:image' content='https://github.com/kwea123/CasMVSNet_pl/raw/master/assets/demo.png' />
<meta name="twitter:title" content="test: Points - MVSNets | Restore Point Cloud from Depth Map">
<meta name="twitter:description" content="(Feature image is from: CasMVSNet_pl)
Restoring point cloud: Fuse depth maps of multi-views, and then unproject the depth map to 3D points.
MVSNet-PyTorch Source code: MVSNet-PyTorch
Download pretrained model checkpoint
1 gdown 1j2I_LNKb9JeCl6wdA7hh8z1WgVQZfLU9 -O ./checkpoints/pretrained/MVSNet-Pytorch_model_000014.ckpt Download preprocessed testing data of MVSNet
1 2 gdown 135oKPefcPTsdtLRzoDAQtPpHuoIrpRI_ -O /data2/zichen/MVSNet_testing_dtu.zip unzip /data2/zichen/MVSNet_testing_dtu.zip -d /data2/zichen/MVSNet_testing Modify data paths in eval.sh, and uncomment the line#302: save_depth() in &amp;ldquo;eval.py&amp;rdquo; to generate depth map first. And then run the script: ."><meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content='https://github.com/kwea123/CasMVSNet_pl/raw/master/assets/demo.png' />
    <link rel="shortcut icon" href="/favicon-32x32.png" />

    </head>
    <body class="
    article-page
    ">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky ">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="Toggle Menu">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header>
        
            
            <figure class="site-avatar">
                <a href="/">
                
                    
                    
                    
                        
                        <img src="/img/avatar_hu238e2fe759432347fa5dd53661ac4381_131637_300x0_resize_box_3.png" width="300"
                            height="300" class="site-logo" loading="lazy" alt="Avatar">
                    
                
                </a>
                
            </figure>
            
        
        
        <div class="site-meta">
            <h1 class="site-name"><a href="/">Zichen Wang</a></h1>
            <h2 class="site-description"></h2>
        </div>
    </header><ol class="social-menu">
            
                <li>
                    <a 
                        href='https://github.com/zichen34'
                        target="_blank"
                        title="GitHub"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5" />
</svg>



                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://twitter.com/luckily1640'
                        target="_blank"
                        title="Twitter"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-twitter" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M22 4.01c-1 .49 -1.98 .689 -3 .99c-1.121 -1.265 -2.783 -1.335 -4.38 -.737s-2.643 2.06 -2.62 3.737v1c-3.245 .083 -6.135 -1.395 -8 -4c0 0 -4.182 7.433 4 11c-1.872 1.247 -3.739 2.088 -6 2c3.308 1.803 6.913 2.423 10.034 1.517c3.58 -1.04 6.522 -3.723 7.651 -7.742a13.84 13.84 0 0 0 .497 -3.753c-.002 -.249 1.51 -2.772 1.818 -4.013z" />
</svg>



                        
                    </a>
                </li>
            
        </ol><ol class="menu" id="main-menu">
        
        
        
        <li >
            <a href='/aboutme/' >
                
                
                
                <span>About</span>
            </a>
        </li>
        
        
        <li >
            <a href='/writenotes/' >
                
                
                
                <span>WriteNotes</span>
            </a>
        </li>
        
        
        <li >
            <a href='/page/search/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="10" cy="10" r="7" />
  <line x1="21" y1="21" x2="15" y2="15" />
</svg>



                
                <span>Search</span>
            </a>
        </li>
        

        <div class="menu-bottom-section">
            
            
                <li id="dark-mode-toggle">
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="8" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="16" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                    <span>Dark Mode</span>
                </li>
            
        </div>
    </ol>
</aside>

    <aside class="sidebar right-sidebar sticky">
        
            
                
    <section class="widget archives">
        <div class="widget-icon">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



        </div>
        <h2 class="widget-title section-title">Table of contents</h2>
        
        <div class="widget--toc">
            <nav id="TableOfContents">
  <ol>
    <li><a href="#mvsnet-pytorch">MVSNet-PyTorch</a></li>
    <li><a href="#casmvsnet-pl">CasMVSNet-pl</a>
      <ol>
        <li><a href="#environment">Environment</a></li>
        <li><a href="#evaluation">Evaluation</a></li>
        <li><a href="#eval-llff-data">Eval LLFF Data</a></li>
        <li><a href="#eavl-tt">Eavl T&amp;T</a></li>
      </ol>
    </li>
    <li><a href="#depth-map-fusion">Depth map fusion</a></li>
  </ol>
</nav>
        </div>
    </section>

            
        
    </aside>


            <main class="main full-width">
    <article class="has-image main-article">
    <header class="article-header">
        <div class="article-image">
            <a href="/writenotes/model/mvs/b-test-mvs_ply/">
                
                    <img src="https://github.com/kwea123/CasMVSNet_pl/raw/master/assets/demo.png" loading="lazy" alt="Featured image of post test: Points - MVSNets | Restore Point Cloud from Depth Map" />
                
            </a>
        </div>
    

    <div class="article-details">
    
    <header class="article-category">
        
            <a href="/categories/test/" style="background-color: #ff8a22; color: #fff;">
                test
            </a>
        
    </header>
    

    <div class="article-title-wrapper">
        <h2 class="article-title">
            <a href="/writenotes/model/mvs/b-test-mvs_ply/">test: Points - MVSNets | Restore Point Cloud from Depth Map</a>
        </h2>
    
        
    </div>

    
    
    
    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">Feb 21, 2024</time>
            </div>
        

        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



                <time class="article-time--reading">
                    12 minute read
                </time>
            </div>
        
    </footer>
    

    
</div>

</header>

    <section class="article-content">
    
    
    <p><small>(Feature image is from: <a class="link" href="https://github.com/kwea123/CasMVSNet_pl/tree/master/evaluations/dtu"  target="_blank" rel="noopener"
    >CasMVSNet_pl</a>)</small></p>
<hr>
<p>Restoring point cloud: Fuse depth maps of multi-views, and then unproject the depth map to 3D points.</p>
<h2 id="mvsnet-pytorch">MVSNet-PyTorch</h2>
<p>Source code: <a class="link" href="https://github.com/xy-guo/MVSNet_pytorch/tree/master?tab=readme-ov-file#testing"  target="_blank" rel="noopener"
    >MVSNet-PyTorch</a></p>
<ol>
<li>
<p>Download pretrained model <a class="link" href="https://drive.google.com/file/d/1j2I_LNKb9JeCl6wdA7hh8z1WgVQZfLU9/view?usp=sharing"  target="_blank" rel="noopener"
    >checkpoint</a></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">gdown 1j2I_LNKb9JeCl6wdA7hh8z1WgVQZfLU9 -O ./checkpoints/pretrained/MVSNet-Pytorch_model_000014.ckpt
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>Download preprocessed <strong>testing</strong> data of <a class="link" href="https://github.com/YoYo000/MVSNet#download"  target="_blank" rel="noopener"
    >MVSNet</a></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">gdown 135oKPefcPTsdtLRzoDAQtPpHuoIrpRI_ -O /data2/zichen/MVSNet_testing_dtu.zip
</span></span><span class="line"><span class="cl">unzip /data2/zichen/MVSNet_testing_dtu.zip -d /data2/zichen/MVSNet_testing
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>Modify data <strong>paths</strong> in <code>eval.sh</code>, and uncomment the line#302: <code>save_depth()</code> in &ldquo;eval.py&rdquo; to generate depth map first.
And then run the script: <code>./eval.sh</code>.</p>
<p>This program requires 15GB VRAM. so 1080Ti can&rsquo;t run it.</p>
<ul>
<li>
<p>The resolution of the test images (3x1184x1600; Feat map: 32x296x400) is too high to be processed by 1080Ti with 11 GB VRAM.</p>
<p>When processing the 2nd source view, OOM occurs at:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">warped_src_fea</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">grid_sample</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">src_fea</span><span class="p">,</span> <span class="n">grid</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">batch</span><span class="p">,</span> <span class="n">num_depth</span> <span class="o">*</span> <span class="n">height</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;bilinear&#39;</span><span class="p">,</span> <span class="n">padding_mode</span><span class="o">=</span><span class="s1">&#39;zeros&#39;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>(2024-02-23) If executing the <code>eval.py</code> with the <strong>training</strong> images, the Dataset <a class="link" href="https://github.com/xy-guo/MVSNet_pytorch/blob/e0f2ae3d7cb2dd13807b775f2075682eaa7f1521/datasets/dtu_yao_eval.py#L29"  target="_blank" rel="noopener"
    ><code>data_yao_eval</code></a>
may be mismatched with the training data folder.</p>
</li>
</ul>
</li>
<li>
<p>Visualization: &ldquo;outputs/mvsnet001_l3.ply&rdquo;</p>

   
   
   
   
     
     
     
     
      
     
     
      
     
     <img src= /writenotes/model/mvs/img/scan1_MVSNet-PT_2024-02-25.jpg width=>
     
     
   

<p>There are noise point around the round edge of the bowl.</p>
</li>
<li>
<p>Use Matlab to compute the quantitative Metrics:</p>
<p>The DTU dataset (&ldquo;DTU_SampleSet.zip&rdquo;) provides the &ldquo;Matlab evaluation code/&rdquo; to assess the quality of point clouds.</p>
<p>Based on the SampleSet directory structure:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="o">(</span>base<span class="o">)</span> yi@yi:~$ tree /mnt/data2_zichen/SampleSet/ -d -L <span class="m">2</span>
</span></span><span class="line"><span class="cl">/mnt/data2_zichen/SampleSet/
</span></span><span class="line"><span class="cl">├── Matlab evaluation code
</span></span><span class="line"><span class="cl">│   └── MeshSupSamp_web
</span></span><span class="line"><span class="cl">└── MVS Data
</span></span><span class="line"><span class="cl">    ├── Calibration
</span></span><span class="line"><span class="cl">    ├── Cleaned
</span></span><span class="line"><span class="cl">    ├── ObsMask  <span class="c1"># 3D parts used for evaluation</span>
</span></span><span class="line"><span class="cl">    ├── Points   <span class="c1"># ground truth point clouds for each scan</span>
</span></span><span class="line"><span class="cl">    ├── Rectified
</span></span><span class="line"><span class="cl">    └── Surfaces <span class="c1"># Poisson reconstruction</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>
<p>To evaluate point clouds of <strong>all</strong> scans, the folder &ldquo;Points&rdquo; needs to be <strong>replaced</strong> with the
<a class="link" href="https://roboimagedata.compute.dtu.dk/?page_id=36"  target="_blank" rel="noopener"
    >full version &ldquo;Points/&rdquo;</a>.</p>
<p>Create a symbolic link <code>Points</code> in <code>SampleSet/MVS Data</code> for the folder <code>Points/</code>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">ln -s Points/ SampleSet/MVS<span class="se">\ </span>Data/Points
</span></span><span class="line"><span class="cl"><span class="c1"># Or: ln -s Points/ SampleSet/MVS\ Data/</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
<p>Modify the paths and specify the scan to be evaluated in the matlab code:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-matlab" data-lang="matlab"><span class="line"><span class="cl"><span class="c">% ground-truth data:</span>
</span></span><span class="line"><span class="cl"><span class="n">dataPath</span><span class="p">=</span><span class="s">&#39;/mnt/data2_zichen/SampleSet/MVS Data&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="c">% the dir storing testing .ply files:</span>
</span></span><span class="line"><span class="cl"><span class="n">plyPath</span><span class="p">=</span><span class="s">&#39;/mnt/Server/Downloads/MVSNet_pytorch-comments/outputs/pretrained&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="c">% .mat fill will be saved here:</span>
</span></span><span class="line"><span class="cl"><span class="n">resultsPath</span><span class="p">=</span><span class="s">&#39;/mnt/Server/Downloads/MVSNet_pytorch-comments/outputs/pretrained&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="o">-</span> <span class="o">-</span> <span class="o">-</span>
</span></span><span class="line"><span class="cl"><span class="n">UsedSets</span><span class="p">=[</span><span class="mi">1</span><span class="p">]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Run <code>BaseEvalMain_web</code> in matlab:</p>
<details><summary>Output</summary>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">&gt;&gt;&gt; BaseEvalMain_web
</span></span><span class="line"><span class="cl"><span class="nv">cSet</span> <span class="o">=</span>
</span></span><span class="line"><span class="cl">     <span class="m">1</span>
</span></span><span class="line"><span class="cl"><span class="nv">DataInName</span> <span class="o">=</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;/mnt/Server/Downloads/MVSNet_pytorch-comments/outputs/pretrained/mvsnet001_l3.ply&#39;</span>
</span></span><span class="line"><span class="cl"><span class="nv">EvalName</span> <span class="o">=</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;/mnt/Server/Downloads/MVSNet_pytorch-comments/outputs/pretrainedmvsnet_Eval_1.mat&#39;</span>
</span></span><span class="line"><span class="cl">/mnt/Server/Downloads/MVSNet_pytorch-comments/outputs/pretrained/mvsnet001_l3.ply
</span></span><span class="line"><span class="cl"><span class="nv">ans</span> <span class="o">=</span>
</span></span><span class="line"><span class="cl">    <span class="m">19</span>    <span class="m">14</span>
</span></span><span class="line"><span class="cl">Elapsed <span class="nb">time</span> is 58.298360 seconds.
</span></span><span class="line"><span class="cl">downsample factor: 1.6901
</span></span><span class="line"><span class="cl">Elapsed <span class="nb">time</span> is 18.930595 seconds.
</span></span><span class="line"><span class="cl">Computing Data <span class="m">2</span> Stl distances
</span></span><span class="line"><span class="cl">Elapsed <span class="nb">time</span> is 83.304838 seconds.
</span></span><span class="line"><span class="cl">Computing Stl <span class="m">2</span> Data distances
</span></span><span class="line"><span class="cl">Distances computed
</span></span><span class="line"><span class="cl">Elapsed <span class="nb">time</span> is 42.517009 seconds.
</span></span><span class="line"><span class="cl">Saving results
</span></span><span class="line"><span class="cl">Elapsed <span class="nb">time</span> is 42.864935 seconds.
</span></span><span class="line"><span class="cl">Elapsed <span class="nb">time</span> is 52.741538 seconds.
</span></span><span class="line"><span class="cl"><span class="nv">ans</span> <span class="o">=</span>
</span></span><span class="line"><span class="cl">    <span class="m">19</span>    <span class="m">18</span>
</span></span><span class="line"><span class="cl">mean/median Data <span class="o">(</span>acc.<span class="o">)</span> 0.254528/0.180807
</span></span><span class="line"><span class="cl">mean/median Stl <span class="o">(</span>comp.<span class="o">)</span> 0.254594/0.218734
</span></span></code></pre></td></tr></table>
</div>
</div></details>
<ul>
<li>The <strong>samller</strong> the values, the better.</li>
</ul>
</li>
</ol>
<hr>
<h2 id="casmvsnet-pl">CasMVSNet-pl</h2>
<p>(2024-02-23)</p>
<p>Source code: <a class="link" href="https://github.com/kwea123/CasMVSNet_pl"  target="_blank" rel="noopener"
    >CasMVSNet_pl - AIkui</a></p>
<h3 id="environment">Environment</h3>
<ul>
<li>
<p>Depth_raw:</p>
<p>The <a class="link" href="https://github.com/apchenstu/mvsnerf"  target="_blank" rel="noopener"
    >MVSNeRF</a> inherited
some codes of this repo, thus, in mvsnerf&rsquo;s <a class="link" href="https://1drv.ms/u/s!AjyDwSVHuwr8zhAAXh7x5We9czKj?e=oStQ48"  target="_blank" rel="noopener"
    >training dataset</a>,
the directory &ldquo;Depths/&rdquo; under &ldquo;mvs_training/dtu/&rdquo; is also <strong>replaced</strong> with the folder &ldquo;Depths/&rdquo; unzipped from
<a class="link" href="https://virutalbuy-public.oss-cn-hangzhou.aliyuncs.com/share/cascade-stereo/CasMVSNet/dtu_data/dtu_train_hr/Depths_raw.zip"  target="_blank" rel="noopener"
    >&ldquo;Depth_raw.zip&rdquo;</a></p>
</li>
<li>
<p>Create environment:</p>
<p>(2024-04-04)</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">conda create -n casmvsnet_pl <span class="nv">python</span><span class="o">=</span>3.8
</span></span><span class="line"><span class="cl">conda activate casmvsnet_pl
</span></span><span class="line"><span class="cl">pip install <span class="nv">torch</span><span class="o">==</span>1.12.0+cu116 <span class="nv">torchvision</span><span class="o">==</span>0.13.0+cu116 --extra-index-url https://download.pytorch.org/whl/cu116
</span></span><span class="line"><span class="cl">pip install -r requirements.txt
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>Python version:
Environment <code>casmvsnet_pl</code> requires python 3.7 for pytorch 1.4.0, and the packages listed in <code>requirements.txt</code>.
If using python 3.10, the available pytorch version is higher than 1.11.</li>
</ul>
<hr>
<p>(2024-04-07)</p>
<ul>
<li>
<p>Env on Ubuntu 22.04 ctk-11.6 in China:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">conda create -n casmvsnet_pl <span class="nv">python</span><span class="o">=</span>3.8
</span></span><span class="line"><span class="cl"><span class="c1"># pip always breaks when downloading torch.</span>
</span></span><span class="line"><span class="cl">conda install <span class="nv">pytorch</span><span class="o">==</span>1.12.0 <span class="nv">torchvision</span><span class="o">==</span>0.13.0 <span class="nv">cudatoolkit</span><span class="o">=</span>11.6 -c pytorch -c conda-forge
</span></span><span class="line"><span class="cl">pip install -r requirements.txt <span class="c1"># comment torch entries</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>I cannot compile inplace-abn via pip with erros:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">/home/zichen/anaconda3/envs/casmvsnet_pl/lib/python3.8/site-packages/torch/utils/cpp_extension.py:820: UserWarning: There are no g++ version bounds defined <span class="k">for</span> CUDA version 11.6
</span></span><span class="line"><span class="cl">  warnings.warn<span class="o">(</span>f<span class="s1">&#39;There are no {compiler_name} version bounds defined for CUDA version {cuda_str_version}&#39;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">building <span class="s1">&#39;inplace_abn._backend&#39;</span> extension
</span></span><span class="line"><span class="cl">gcc -pthread -B /home/zichen/anaconda3/envs/casmvsnet_pl/compiler_compat -Wl,--sysroot<span class="o">=</span>/ -Wsign-compare -DNDEBUG -g -fwrapv -O3 -Wall -Wstrict-prototypes -fPIC -DWITH_CUDA<span class="o">=</span><span class="m">1</span> -I/home/zichen/Downloads/inplace_abn/include -I/home/zichen/anaconda3/envs/casmvsnet_pl/lib/python3.8/site-packages/torch/include -I/home/zichen/anaconda3/envs/casmvsnet_pl/lib/python3.8/site-packages/torch/include/torch/csrc/api/include -I/home/zichen/anaconda3/envs/casmvsnet_pl/lib/python3.8/site-packages/torch/include/TH -I/home/zichen/anaconda3/envs/casmvsnet_pl/lib/python3.8/site-packages/torch/include/THC -I/usr/local/cuda-11.6/include -I/home/zichen/anaconda3/envs/casmvsnet_pl/include/python3.8 -c src/inplace_abn.cpp -o build/temp.linux-x86_64-cpython-38/src/inplace_abn.o -O3 -DTORCH_API_INCLUDE_EXTENSION_H -DPYBIND11_COMPILER_TYPE<span class="o">=</span><span class="se">\&#34;</span>_gcc<span class="se">\&#34;</span> -DPYBIND11_STDLIB<span class="o">=</span><span class="se">\&#34;</span>_libstdcpp<span class="se">\&#34;</span> -DPYBIND11_BUILD_ABI<span class="o">=</span><span class="se">\&#34;</span>_cxxabi1013<span class="se">\&#34;</span> -DTORCH_EXTENSION_NAME<span class="o">=</span>_backend -D_GLIBCXX_USE_CXX11_ABI<span class="o">=</span><span class="m">0</span> -std<span class="o">=</span>c++14
</span></span><span class="line"><span class="cl">cc1plus: warning: command-line option ‘-Wstrict-prototypes’ is valid <span class="k">for</span> C/ObjC but not <span class="k">for</span> C++
</span></span><span class="line"><span class="cl">gcc -pthread -B /home/zichen/anaconda3/envs/casmvsnet_pl/compiler_compat -Wl,--sysroot<span class="o">=</span>/ -Wsign-compare -DNDEBUG -g -fwrapv -O3 -Wall -Wstrict-prototypes -fPIC -DWITH_CUDA<span class="o">=</span><span class="m">1</span> -I/home/zichen/Downloads/inplace_abn/include -I/home/zichen/anaconda3/envs/casmvsnet_pl/lib/python3.8/site-packages/torch/include -I/home/zichen/anaconda3/envs/casmvsnet_pl/lib/python3.8/site-packages/torch/include/torch/csrc/api/include -I/home/zichen/anaconda3/envs/casmvsnet_pl/lib/python3.8/site-packages/torch/include/TH -I/home/zichen/anaconda3/envs/casmvsnet_pl/lib/python3.8/site-packages/torch/include/THC -I/usr/local/cuda-11.6/include -I/home/zichen/anaconda3/envs/casmvsnet_pl/include/python3.8 -c src/inplace_abn_cpu.cpp -o build/temp.linux-x86_64-cpython-38/src/inplace_abn_cpu.o -O3 -DTORCH_API_INCLUDE_EXTENSION_H -DPYBIND11_COMPILER_TYPE<span class="o">=</span><span class="se">\&#34;</span>_gcc<span class="se">\&#34;</span> -DPYBIND11_STDLIB<span class="o">=</span><span class="se">\&#34;</span>_libstdcpp<span class="se">\&#34;</span> -DPYBIND11_BUILD_ABI<span class="o">=</span><span class="se">\&#34;</span>_cxxabi1013<span class="se">\&#34;</span> -DTORCH_EXTENSION_NAME<span class="o">=</span>_backend -D_GLIBCXX_USE_CXX11_ABI<span class="o">=</span><span class="m">0</span> -std<span class="o">=</span>c++14
</span></span><span class="line"><span class="cl">cc1plus: warning: command-line option ‘-Wstrict-prototypes’ is valid <span class="k">for</span> C/ObjC but not <span class="k">for</span> C++
</span></span><span class="line"><span class="cl">/usr/local/cuda-11.6/bin/nvcc -DWITH_CUDA<span class="o">=</span><span class="m">1</span> -I/home/zichen/Downloads/inplace_abn/include -I/home/zichen/anaconda3/envs/casmvsnet_pl/lib/python3.8/site-packages/torch/include -I/home/zichen/anaconda3/envs/casmvsnet_pl/lib/python3.8/site-packages/torch/include/torch/csrc/api/include -I/home/zichen/anaconda3/envs/casmvsnet_pl/lib/python3.8/site-packages/torch/include/TH -I/home/zichen/anaconda3/envs/casmvsnet_pl/lib/python3.8/site-packages/torch/include/THC -I/usr/local/cuda-11.6/include -I/home/zichen/anaconda3/envs/casmvsnet_pl/include/python3.8 -c src/inplace_abn_cuda.cu -o build/temp.linux-x86_64-cpython-38/src/inplace_abn_cuda.o -D__CUDA_NO_HALF_OPERATORS__ -D__CUDA_NO_HALF_CONVERSIONS__ -D__CUDA_NO_BFLOAT16_CONVERSIONS__ -D__CUDA_NO_HALF2_OPERATORS__ --expt-relaxed-constexpr --compiler-options <span class="s1">&#39;-fPIC&#39;</span> -DTORCH_API_INCLUDE_EXTENSION_H -DPYBIND11_COMPILER_TYPE<span class="o">=</span><span class="se">\&#34;</span>_gcc<span class="se">\&#34;</span> -DPYBIND11_STDLIB<span class="o">=</span><span class="se">\&#34;</span>_libstdcpp<span class="se">\&#34;</span> -DPYBIND11_BUILD_ABI<span class="o">=</span><span class="se">\&#34;</span>_cxxabi1013<span class="se">\&#34;</span> -DTORCH_EXTENSION_NAME<span class="o">=</span>_backend -D_GLIBCXX_USE_CXX11_ABI<span class="o">=</span><span class="m">0</span> -gencode<span class="o">=</span><span class="nv">arch</span><span class="o">=</span>compute_86,code<span class="o">=</span>compute_86 -gencode<span class="o">=</span><span class="nv">arch</span><span class="o">=</span>compute_86,code<span class="o">=</span>sm_86 -std<span class="o">=</span>c++14
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">/home/zichen/anaconda3/envs/casmvsnet_pl/lib/python3.8/site-packages/torch/include/c10/core/SymInt.h<span class="o">(</span>84<span class="o">)</span>: warning <span class="c1">#68-D: integer conversion resulted in a change of sign</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">     /usr/include/c++/11/bits/std_function.h:435:145: error: parameter packs not expanded with ‘...’:
</span></span><span class="line"><span class="cl">       <span class="m">435</span> <span class="p">|</span>         <span class="k">function</span><span class="o">(</span>_Functor<span class="o">&amp;&amp;</span> __f<span class="o">)</span>
</span></span><span class="line"><span class="cl">           <span class="p">|</span>                                                                                                                                                 ^
</span></span><span class="line"><span class="cl">     /usr/include/c++/11/bits/std_function.h:435:145: note:         ‘_ArgTypes’
</span></span><span class="line"><span class="cl">     /usr/include/c++/11/bits/std_function.h:530:146: error: parameter packs not expanded with ‘...’:
</span></span><span class="line"><span class="cl">       <span class="m">530</span> <span class="p">|</span>         <span class="nv">operator</span><span class="o">=(</span>_Functor<span class="o">&amp;&amp;</span> __f<span class="o">)</span>
</span></span><span class="line"><span class="cl">           <span class="p">|</span>                                                                                                                                                  ^
</span></span><span class="line"><span class="cl">     /usr/include/c++/11/bits/std_function.h:530:146: note:         ‘_ArgTypes’
</span></span><span class="line"><span class="cl">     error: <span class="nb">command</span> <span class="s1">&#39;/usr/local/cuda-11.6/bin/nvcc&#39;</span> failed with <span class="nb">exit</span> code <span class="m">1</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Then, I tried to install it through compiling the <a class="link" href="https://github.com/mapillary/inplace_abn"  target="_blank" rel="noopener"
    >source code</a>.
Unfortunately, the same error ocurred.</p>
<p>I compiled the source code on Ubuntu 20.04 and ctk-11.6 (I had created a same conda env using the above 2 lines.
When using the <code>pip install</code> manner, it will find the previous cache of the inplace-abn package on the machine.).
Superisingly, the compilation suceeded.</p>
<p>The crucial <strong>difference</strong> between the 2 trials could be the <strong>gcc version</strong> <code>gcc --version</code>. Their return values are:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">gcc <span class="o">(</span>Ubuntu 9.4.0-1ubuntu1~20.04.2<span class="o">)</span> 9.4.0
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">gcc <span class="o">(</span>Ubuntu 11.4.0-1ubuntu1~22.04<span class="o">)</span> 11.4.0
</span></span></code></pre></td></tr></table>
</div>
</div><p>After I changed to <strong>gcc-9</strong> on Ubuntu 22.04, the compilation for inplace-abn <strong>succeeded</strong>.</p>
<ul>
<li>
<p>I was reminded to check <code>gcc</code> due to ChatGPT&rsquo;s response (prompted with the above error),
and the issuse <a class="link" href="https://github.com/mapillary/inplace_abn/issues/232#issuecomment-1522625045"  target="_blank" rel="noopener"
    >CUDA version (12.1) #232</a>
and this issue asked gcc: <a class="link" href="https://github.com/mapillary/inplace_abn/issues/143#issuecomment-557562119"  target="_blank" rel="noopener"
    >failed install #143</a></p>
</li>
<li>
<p>There is another solution: <a class="link" href="https://zhuanlan.zhihu.com/p/537939186"  target="_blank" rel="noopener"
    >inplace_abn安装报错？来看看这篇避坑指南吧！</a>
But I didn&rsquo;t try it.</p>
</li>
</ul>
<hr>
<p><strong>How to change gcc version</strong>:</p>
<p>Ref: <a class="link" href="https://linuxconfig.org/how-to-switch-between-multiple-gcc-and-g-compiler-versions-on-ubuntu-22-04-lts-jammy-jellyfish"  target="_blank" rel="noopener"
    >How to switch between multiple GCC and G++ compiler versions on Ubuntu 22.04 LTS Jammy Jellyfish</a></p>
<ol>
<li>
<p>There are multiple gcc versions under <code>/usr/bin/</code>.</p>
<p>But, they didn&rsquo;t show up:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="o">(</span>casmvsnet_pl_<span class="o">)</span> z@homepc:~/Downloads/inplace_abn$ update-alternatives --list gcc
</span></span><span class="line"><span class="cl">update-alternatives: error: no alternatives <span class="k">for</span> gcc
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>Install GCC 9: <code>sudo apt-get install gcc-9 g++-9</code>.</p>
</li>
<li>
<p>It&rsquo;s said the 2 lines below are creating list for multiple gcc and g++:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo update-alternatives --install /usr/bin/gcc gcc /usr/bin/gcc-9 <span class="m">9</span>
</span></span><span class="line"><span class="cl">sudo update-alternatives --install /usr/bin/g++ g++ /usr/bin/g++-9 <span class="m">9</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>But once I exectuted them, the <code>gcc --version</code> has changed to gcc 9.5.0</p>
<p>The gcc and g++ will revert to 11.4 by executing:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo update-alternatives --install /usr/bin/gcc gcc /usr/bin/gcc-11 <span class="m">11</span>
</span></span><span class="line"><span class="cl">sudo update-alternatives --install /usr/bin/g++ g++ /usr/bin/g++-11 <span class="m">11</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>(2024-05-13)</p>
<details><summary> Install gcc-7 </summary>
<ul>
<li>
<p>I want to use gcc-7 to compile PCL. I installed g++-7 as below, and specify it as default:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo add-apt-repository ppa:ubuntu-toolchain-r/test
</span></span><span class="line"><span class="cl">sudo apt update <span class="o">&amp;&amp;</span> apt install g++-7 -y
</span></span><span class="line"><span class="cl">sudo update-alternatives --install /usr/bin/gcc gcc /usr/bin/gcc-7 <span class="m">60</span> --slave /usr/bin/g++ g++ /usr/bin/g++-7
</span></span></code></pre></td></tr></table>
</div>
</div><p>However, an error prompted when install g++-9, because it <code>can't be master</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="o">(</span>base<span class="o">)</span> yi@Alien:~$ sudo update-alternatives --install /usr/bin/gcc gcc /usr/bin/gcc-9 <span class="m">9</span>
</span></span><span class="line"><span class="cl"><span class="o">(</span>base<span class="o">)</span> yi@Alien:~$ sudo update-alternatives --install /usr/bin/g++ g++ /usr/bin/g++-9 <span class="m">9</span>
</span></span><span class="line"><span class="cl">update-alternatives: error: alternative g++ can<span class="err">&#39;</span>t be master: it is a slave of gcc
</span></span></code></pre></td></tr></table>
</div>
</div><p>So, I use a one-line command similar to the above gcc-7:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="o">(</span>base<span class="o">)</span> yi@Alien:~$ sudo update-alternatives --install /usr/bin/gcc gcc /usr/bin/gcc-9 <span class="m">9</span> --slave /usr/bin/g++ g++ /usr/bin/g++-9
</span></span></code></pre></td></tr></table>
</div>
</div><p>(Ref: <a class="link" href="https://stackoverflow.com/a/70653945/18003182"  target="_blank" rel="noopener"
    >Update gcc alternatives in Ubuntu 18.04 - g++ cannot be slave of gcc</a>)</p>
</li>
</ul>
</details>
</li>
<li>
<p>Later, the versions can be chosen from a list:</p>
<p><code>sudo update-alternatives --config gcc</code></p>
</li>
</ol>
</li>
</ul>
</li>
</ul>
<hr>
<ul>
<li>
<p>Not found GPU:</p>
<p>Although the Pytorch 1.4.0 (installed with <code>pip</code>) was compiled with cuda 10.1
(<a class="link" href="https://pytorch.org/get-started/previous-versions/#linux-and-windows-47"  target="_blank" rel="noopener"
    >download</a>),
the cudatoolkit (<code>nvcc -V</code>) on the PATH is <strong>not</strong> neccessary to match the cuda version.</p>
<p>For example, with using the <strong>same</strong> conda environemnt,
Alien-PC (Ubuntu 20.04) using cuda-11.6 and the lambda server (Ubuntu 18.04) using cuda-10.2 both can detect GPU and run.</p>
<p>The error: <code>torch.cuda.is_available()</code> returns <code>False</code>here is not
due to cuda, but my debug settings!!! Fuck!!
the <strong>environment variable</strong> <code>CUDA_VISIBLE_DEVICES</code> in <code>launch.json</code> was set to 6 for server, which should be 0 on my PC.</p>
</li>
</ul>
<hr>
<p>(2024-04-13)</p>
<ul>
<li>
<p>Create an environment again on Lambda server: Ubuntu 18.04, cudatoolkit 11.6 (<code>nvcc -V</code>),
and gcc, g++ both are 7.5.0 (<code>gcc -v</code>)</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="o">(</span>casmvsnet_pl_py38<span class="o">)</span> z@lambda-server:~/Downloads/CasMVSNet_pl-comments$ g++ -v
</span></span><span class="line"><span class="cl">Using built-in specs.
</span></span><span class="line"><span class="cl"><span class="nv">COLLECT_GCC</span><span class="o">=</span>g++
</span></span><span class="line"><span class="cl"><span class="nv">COLLECT_LTO_WRAPPER</span><span class="o">=</span>/usr/lib/gcc/x86_64-linux-gnu/7/lto-wrapper
</span></span><span class="line"><span class="cl"><span class="nv">OFFLOAD_TARGET_NAMES</span><span class="o">=</span>nvptx-none
</span></span><span class="line"><span class="cl"><span class="nv">OFFLOAD_TARGET_DEFAULT</span><span class="o">=</span><span class="m">1</span>
</span></span><span class="line"><span class="cl">Target: x86_64-linux-gnu
</span></span><span class="line"><span class="cl">Configured with: ../src/configure -v --with-pkgversion<span class="o">=</span><span class="s1">&#39;Ubuntu 7.5.0-3ubuntu1~18.04&#39;</span> --with-bugurl<span class="o">=</span>file:///usr/share/doc/gcc-7/README.Bugs --enable-languages<span class="o">=</span>c,ada,c++,go,brig,d,fortran,objc,obj-c++ --prefix<span class="o">=</span>/usr --with-gcc-major-version-only --program-suffix<span class="o">=</span>-7 --program-prefix<span class="o">=</span>x86_64-linux-gnu- --enable-shared --enable-linker-build-id --libexecdir<span class="o">=</span>/usr/lib --without-included-gettext --enable-threads<span class="o">=</span>posix --libdir<span class="o">=</span>/usr/lib --enable-nls --enable-bootstrap --enable-clocale<span class="o">=</span>gnu --enable-libstdcxx-debug --enable-libstdcxx-time<span class="o">=</span>yes --with-default-libstdcxx-abi<span class="o">=</span>new --enable-gnu-unique-object --disable-vtable-verify --enable-libmpx --enable-plugin --enable-default-pie --with-system-zlib --with-target-system-zlib --enable-objc-gc<span class="o">=</span>auto --enable-multiarch --disable-werror --with-arch-32<span class="o">=</span>i686 --with-abi<span class="o">=</span>m64 --with-multilib-list<span class="o">=</span>m32,m64,mx32 --enable-multilib --with-tune<span class="o">=</span>generic --enable-offload-targets<span class="o">=</span>nvptx-none --without-cuda-driver --enable-checking<span class="o">=</span>release --build<span class="o">=</span>x86_64-linux-gnu --host<span class="o">=</span>x86_64-linux-gnu --target<span class="o">=</span>x86_64-linux-gnu
</span></span><span class="line"><span class="cl">Thread model: posix
</span></span><span class="line"><span class="cl">gcc version 7.5.0 <span class="o">(</span>Ubuntu 7.5.0-3ubuntu1~18.04<span class="o">)</span> 
</span></span></code></pre></td></tr></table>
</div>
</div><p>The pytorch is not install separately, just using the requirements.txt as below.
<a class="link" href="https://github.com/zichen34/CasMVSNet_pl-comments/commit/d11a0ff732e3a59c6553c1746f2fd2fb1f2573d6"  target="_blank" rel="noopener"
    >Git commit</a></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">conda create -n casmvsnet_pl_py38 <span class="nv">python</span><span class="o">=</span>3.8
</span></span><span class="line"><span class="cl">conda activate casmvsnet_pl_py38
</span></span><span class="line"><span class="cl">pip install -r requirements.txt
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
<hr>
<h3 id="evaluation">Evaluation</h3>
<p>Evaluation and Depth Map Fusion: <a class="link" href="https://github.com/kwea123/CasMVSNet_pl/tree/master/evaluations"  target="_blank" rel="noopener"
    >evalutions/</a></p>
<ol>
<li>
<p>Download pretrained model <a class="link" href="https://github.com/kwea123/CasMVSNet_pl/releases/tag/v1.0"  target="_blank" rel="noopener"
    >checkpoint</a></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">mkdir -p ckpts
</span></span><span class="line"><span class="cl">wget https://github.com/kwea123/CasMVSNet_pl/releases/download/v1.0/exp2.zip -P ckpts/
</span></span><span class="line"><span class="cl">unzip ckpts/exp2.zip -d ckpts/
</span></span><span class="line"><span class="cl">wget https://github.com/kwea123/CasMVSNet_pl/releases/download/v1.0/_ckpt_epoch_10.ckpt -P ckpts/exp2
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>Specify testing data</p>
<ul>
<li>
<p>I only left <code>scan9</code> in &ldquo;lists/test.txt&rdquo; for a quick peek.</p>
</li>
<li>
<p>The code has some path templates that don&rsquo;t match the DTU <strong>testing</strong> data directory structure.</p>
<details><summary> Code Modifications </summary>
<p>File: <code>datasets/dtu.py</code>, <code>build_metas()</code> (line #40-42):</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">pair_file</span> <span class="o">=</span> <span class="s2">&#34;pair.txt&#34;</span>   <span class="c1"># Make 49 * 22 testing pairs</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">scan</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">scans</span><span class="p">:</span>  <span class="c1"># add `scan` into path</span>
</span></span><span class="line"><span class="cl">  <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root_dir</span><span class="p">,</span> <span class="n">scan</span><span class="p">,</span> <span class="n">pair_file</span><span class="p">))</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>File: <code>datasets/dtu.py</code>, <code>build_proj_mats</code> (Line #58-59):</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># all scans have the same cams, so hardcard &#39;scan1&#39; here:</span>
</span></span><span class="line"><span class="cl"><span class="n">proj_mat_filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root_dir</span><span class="p">,</span> <span class="s1">&#39;scan1&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                    <span class="sa">f</span><span class="s1">&#39;cams/</span><span class="si">{</span><span class="n">vid</span><span class="si">:</span><span class="s1">08d</span><span class="si">}</span><span class="s1">_cam.txt&#39;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>File: <code>datasets/dtu.py</code>, <code>__getitem__()</code> (Line #165-166):</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Add `scan` into path:</span>
</span></span><span class="line"><span class="cl"><span class="n">img_filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root_dir</span><span class="p">,</span> <span class="n">scan</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="sa">f</span><span class="s1">&#39;images/</span><span class="si">{</span><span class="n">vid</span><span class="si">:</span><span class="s1">08d</span><span class="si">}</span><span class="s1">.jpg&#39;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>File: <code>eval.py</code>, <code>read_image()</code> (line #87):</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">if</span> <span class="n">dataset_name</span> <span class="o">==</span> <span class="s1">&#39;dtu&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root_dir</span><span class="p">,</span> <span class="n">scan</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;images/</span><span class="si">{</span><span class="n">vid</span><span class="si">:</span><span class="s1">08d</span><span class="si">}</span><span class="s1">.jpg&#39;</span><span class="p">))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>File: <code>eval.py</code>, (Line #352): set name format to align the matlab code (of the MVSNet_pytorch).</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">PlyData</span><span class="p">([</span><span class="n">el</span><span class="p">])</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">point_dir</span><span class="si">}</span><span class="s1">/scan</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">scan</span><span class="p">[</span><span class="mi">4</span><span class="p">:])</span><span class="si">:</span><span class="s1">03d</span><span class="si">}</span><span class="s1">_l3.ply&#39;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div></details>
</li>
</ul>
</li>
<li>
<p>Execute <code>eval.py</code>. (1080Ti is okay.)</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="nv">CUDA_VISIBLE_DEVICES</span><span class="o">=</span><span class="m">5</span> python eval.py --root_dir /data2/zichen/MVSNet_testing/dtu
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>Visualization:</p>
<p>Import the result point cloud &ldquo;results/dtu/points/scan9.ply&rdquo; into <a class="link" href="https://www.meshlab.net/"  target="_blank" rel="noopener"
    >MeshLab</a>:</p>
<div class="table-wrapper"><table>
<thead>
<tr>
<th>




  
  
  
  
   
  
  
   
  
  <img src= /writenotes/model/mvs/img/scan9_CasMVSNet-pl_2024-02-23.jpg width=>
  
  

</th>
<th>




  
  
  
  
   
  
  
   
  
  <img src= /writenotes/model/mvs/img/scan9_MVSNet-PT_2024-02-25.jpg width=>
  
  

</th>
</tr>
</thead>
<tbody>
<tr>
<td>casmvsnet</td>
<td>mvsnet</td>
</tr>
</tbody>
</table></div>
<ul>
<li>
<p>Some floaters will be exposed when looking at the point cloud from novel views.</p>
</li>
<li>
<p>CasMVSNet-pl has less noise points than MVSNet-pytorch.</p>
</li>
</ul>
</li>
<li>
<p>Modify the paths in &ldquo;BaseEvalMain_web.m&rdquo; (of the MVSNet_pytorch):</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-matlab" data-lang="matlab"><span class="line"><span class="cl"><span class="n">dataPath</span><span class="p">=</span><span class="s">&#39;/mnt/data2_zichen/SampleSet/MVS Data&#39;</span><span class="p">;</span> <span class="c">% GT</span>
</span></span><span class="line"><span class="cl"><span class="n">plyPath</span><span class="p">=</span><span class="s">&#39;/mnt/Server/Downloads/CasMVSNet_pl/results/dtu/points&#39;</span><span class="p">;</span> <span class="c">% pred</span>
</span></span><span class="line"><span class="cl"><span class="n">resultsPath</span><span class="p">=</span><span class="s">&#39;/mnt/Server/Downloads/CasMVSNet_pl/results&#39;</span><span class="p">;</span> <span class="c">% store .mat</span>
</span></span><span class="line"><span class="cl"><span class="n">method_string</span><span class="p">=</span><span class="s">&#39;scan&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="o">-</span> <span class="o">-</span> <span class="o">-</span>
</span></span><span class="line"><span class="cl"><span class="n">UsedSets</span><span class="p">=[</span><span class="mi">9</span><span class="p">]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><details><summary> Output for scan9 </summary>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-matlab" data-lang="matlab"><span class="line"><span class="cl"><span class="n">cSet</span> <span class="p">=</span>
</span></span><span class="line"><span class="cl">     <span class="mi">9</span>
</span></span><span class="line"><span class="cl"><span class="n">DataInName</span> <span class="p">=</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#39;/mnt/Server/Downloads/CasMVSNet_pl/results/dtu/points/scan009_l3.ply&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">EvalName</span> <span class="p">=</span>
</span></span><span class="line"><span class="cl">    <span class="s">&#39;/mnt/Server/Downloads/CasMVSNet_pl/resultsscan_Eval_9.mat&#39;</span>
</span></span><span class="line"><span class="cl"><span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="n">Server</span><span class="o">/</span><span class="n">Downloads</span><span class="o">/</span><span class="n">CasMVSNet_pl</span><span class="o">/</span><span class="n">results</span><span class="o">/</span><span class="n">dtu</span><span class="o">/</span><span class="n">points</span><span class="o">/</span><span class="n">scan009_l3</span><span class="p">.</span><span class="n">ply</span>
</span></span><span class="line"><span class="cl"><span class="nb">ans</span> <span class="p">=</span>
</span></span><span class="line"><span class="cl">     <span class="mi">0</span>    <span class="mi">35</span>
</span></span><span class="line"><span class="cl"><span class="n">Elapsed</span> <span class="n">time</span> <span class="n">is</span> <span class="mf">412.622045</span> <span class="n">seconds</span><span class="p">.</span>
</span></span><span class="line"><span class="cl"><span class="n">downsample</span> <span class="nb">factor</span><span class="p">:</span> <span class="mf">5.5621</span>
</span></span><span class="line"><span class="cl"><span class="n">Elapsed</span> <span class="n">time</span> <span class="n">is</span> <span class="mf">285.285496</span> <span class="n">seconds</span><span class="p">.</span>
</span></span><span class="line"><span class="cl"><span class="n">Computing</span> <span class="n">Data</span> <span class="mi">2</span> <span class="n">Stl</span> <span class="n">distances</span>
</span></span><span class="line"><span class="cl"><span class="n">Elapsed</span> <span class="n">time</span> <span class="n">is</span> <span class="mf">101.764399</span> <span class="n">seconds</span><span class="p">.</span>
</span></span><span class="line"><span class="cl"><span class="n">Computing</span> <span class="n">Stl</span> <span class="mi">2</span> <span class="n">Data</span> <span class="n">distances</span>
</span></span><span class="line"><span class="cl"><span class="n">Distances</span> <span class="n">computed</span>
</span></span><span class="line"><span class="cl"><span class="n">Elapsed</span> <span class="n">time</span> <span class="n">is</span> <span class="mf">106.225475</span> <span class="n">seconds</span><span class="p">.</span>
</span></span><span class="line"><span class="cl"><span class="n">Saving</span> <span class="n">results</span>
</span></span><span class="line"><span class="cl"><span class="n">Elapsed</span> <span class="n">time</span> <span class="n">is</span> <span class="mf">106.982512</span> <span class="n">seconds</span><span class="p">.</span>
</span></span><span class="line"><span class="cl"><span class="n">Elapsed</span> <span class="n">time</span> <span class="n">is</span> <span class="mf">126.089258</span> <span class="n">seconds</span><span class="p">.</span>
</span></span><span class="line"><span class="cl"><span class="nb">ans</span> <span class="p">=</span>
</span></span><span class="line"><span class="cl">     <span class="mi">0</span>    <span class="mi">52</span>
</span></span><span class="line"><span class="cl"><span class="n">mean</span><span class="o">/</span><span class="n">median</span> <span class="n">Data</span> <span class="p">(</span><span class="n">acc</span><span class="p">.)</span> <span class="mf">0.357586</span><span class="o">/</span><span class="mf">0.229884</span>
</span></span><span class="line"><span class="cl"><span class="n">mean</span><span class="o">/</span><span class="n">median</span> <span class="n">Stl</span> <span class="p">(</span><span class="n">comp</span><span class="p">.)</span> <span class="mf">0.304593</span><span class="o">/</span><span class="mf">0.177679</span>
</span></span></code></pre></td></tr></table>
</div>
</div></details>
<p>Evaluate point clouds of all testing scans with matlab and save outputs into <code>write.txt</code> for calculating the average performance:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">re</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">means_acc</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl"><span class="n">means_comp</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl"><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&#34;/mnt/Server/Downloads/MVSNet_pytorch-comments/evaluations/dtu/write.txt&#34;</span><span class="p">,</span> <span class="s2">&#34;r&#34;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">file</span><span class="o">.</span><span class="n">readlines</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="s1">&#39;acc.&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">means_acc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="nb">eval</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;\d+\.\d+|\d+&#39;</span><span class="p">,</span><span class="n">line</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">elif</span> <span class="s1">&#39;comp.&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span> 
</span></span><span class="line"><span class="cl">            <span class="n">means_comp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="nb">eval</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;\d+\.\d+|\d+&#39;</span><span class="p">,</span><span class="n">line</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">means_acc</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">means_comp</span><span class="p">))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Output: <code>0.36399536, 0.36997940</code></p>
<details><summary> Results of every scan. </summary>
<div class="table-wrapper"><table>
<thead>
<tr>
<th>scans</th>
<th>accuracy</th>
<th>Completness</th>
<th>num pts</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>0.235012/0.177113</td>
<td>0.219228/0.176128</td>
<td>29.40M</td>
</tr>
<tr>
<td>4</td>
<td>0.267118/0.198705</td>
<td>0.376820/0.192314</td>
<td>23.06M</td>
</tr>
<tr>
<td>9</td>
<td>0.312725/0.196551</td>
<td>0.204539/0.169905</td>
<td>25.38M</td>
</tr>
<tr>
<td>10</td>
<td>23.63M</td>
<td></td>
<td></td>
</tr>
<tr>
<td>11</td>
<td>19.57M</td>
<td></td>
<td></td>
</tr>
<tr>
<td>12</td>
<td>21.47M</td>
<td></td>
<td></td>
</tr>
<tr>
<td>13</td>
<td>22.35M</td>
<td></td>
<td></td>
</tr>
<tr>
<td>15</td>
<td>26.06M</td>
<td></td>
<td></td>
</tr>
<tr>
<td>23</td>
<td>29.97M</td>
<td></td>
<td></td>
</tr>
<tr>
<td>24</td>
<td>24.95M</td>
<td></td>
<td></td>
</tr>
<tr>
<td>29</td>
<td>19.67M</td>
<td></td>
<td></td>
</tr>
<tr>
<td>32</td>
<td>22.06M</td>
<td></td>
<td></td>
</tr>
<tr>
<td>33</td>
<td>16.67M</td>
<td></td>
<td></td>
</tr>
<tr>
<td>34</td>
<td>28.18M</td>
<td></td>
<td></td>
</tr>
<tr>
<td>48</td>
<td>15.82M</td>
<td></td>
<td></td>
</tr>
<tr>
<td>49</td>
<td>19.90M</td>
<td></td>
<td></td>
</tr>
<tr>
<td>62</td>
<td>22.97M</td>
<td></td>
<td></td>
</tr>
<tr>
<td>75</td>
<td>18.60M</td>
<td></td>
<td></td>
</tr>
<tr>
<td>77</td>
<td>7.46 M</td>
<td></td>
<td></td>
</tr>
<tr>
<td>110</td>
<td>27.34M</td>
<td></td>
<td></td>
</tr>
<tr>
<td>114</td>
<td>0.223317/0.169992</td>
<td>0.249666/0.178679</td>
<td>31.52M</td>
</tr>
<tr>
<td>118</td>
<td>0.243320/0.183991</td>
<td>0.403758/0.195397</td>
<td>30.18M</td>
</tr>
<tr>
<td>avg 22</td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table></div>
</details>
</li>
</ol>
<hr>
<p>(2024-04-03)</p>
<ul>
<li>
<p>Visualization for scan1:</p>

  
  
  
  
    
    
    
    
     
    
    
     
    
    <img src= /writenotes/model/mvs/img/CasMVSNet_dtu_scan001_l3_ply.jpg width=50%>
    
    
  

<ul>
<li>The aliasing: <a class="link" href="https://en.wikipedia.org/wiki/Moir%C3%A9_pattern"  target="_blank" rel="noopener"
    >Moiré pattern</a> (摩尔纹)
resulted from insufficient <strong>sampling frequency</strong> is wave interference (波的干涉).</li>
</ul>
</li>
</ul>
<hr>
<h3 id="eval-llff-data">Eval LLFF Data</h3>
<p>(2024-04-15)</p>
<ol>
<li>
<p>Convert LLFF dataset to the format of MVSNet.</p>
<p>Use Colmap to solve the LLFF images: <a class="link" href="https://colmap.github.io/tutorial.html"  target="_blank" rel="noopener"
    >Colmap Tutorial</a>;
<a class="link" href="https://youtu.be/mUDzWCuopBo?si=BtuaNWEJHy10noxa"  target="_blank" rel="noopener"
    >Ytb</a>
(The camera poses in NeRF are also recovered by Colmap with <a class="link" href="https://github.com/fyusion/llff#1-recover-camera-poses"  target="_blank" rel="noopener"
    >imgs2poses</a>),
and then use the script <a class="link" href="https://github.com/YoYo000/MVSNet#mvsnet-input-from-sfm-output"  target="_blank" rel="noopener"
    >colmap2mvsnet.py</a>
provided by MVSNet to obtain matched format.</p>
</li>
</ol>
<hr>
<h3 id="eavl-tt">Eavl T&amp;T</h3>
<p>(2024-05-25)</p>
<p>Dataset: <a class="link" href="https://www.tanksandtemples.org/"  target="_blank" rel="noopener"
    >Tanks and Temples</a></p>
<ul>
<li>
<p>The F-score of the testing sets (without GT published) should be evaluated by submitting the point cloud (.ply) to their webpage.
(<a class="link" href="https://github.com/isl-org/TanksAndTemples"  target="_blank" rel="noopener"
    >Github</a>)</p>
<ul>
<li>
<p>From the leaderboard, the results of MVSNet and casmvsnet_pl can be found there.</p>
</li>
<li>
<p>3DGS shows the PSNR, rather than F-score.</p>
</li>
</ul>
</li>
<li>
<p>The training sets have GT provided.</p>
</li>
<li>
<p><a class="link" href="https://arxiv.org/abs/1804.02505"  target="_blank" rel="noopener"
    >MVSNet Sec5.2</a>
evaluates its f-score on the <strong>intermediate set</strong> (Family, Francis, Horse, Lighthouse, M60, Panther, Playground, Train) of T&amp;T.</p>
<ul>
<li>
<p>The <code>intermediate.zip</code> only contains .mp4 videos.</p>
</li>
<li>
<p>N = 5, W = 1920, H = 1056 and D = 256</p>
</li>
<li>
<p><a class="link" href="https://www.tanksandtemples.org/leaderboard/?table_0-page=2#:~:text=43.30-,MVSNet,-417.00"  target="_blank" rel="noopener"
    >MVSNet</a>
418	43.48	N.A.	55.99	28.55	25.07	50.79	53.96	50.86	47.9	34.69</p>
</li>
</ul>
</li>
<li>
<p><a class="link" href="https://github.com/kwea123/CasMVSNet_pl/tree/master/evaluations/tanks"  target="_blank" rel="noopener"
    >CasMVSNet_pl</a>
is tested on T&amp;T with the default parameter in eval.py.</p>
<ul>
<li><a class="link" href="https://www.tanksandtemples.org/leaderboard/?table_0-page=2#:~:text=47.54-,CasMVSNet_pl,-295.50"  target="_blank" rel="noopener"
    >CasMVSNet_pl</a>
296.25	55.09	N.A.	76.4	52.83	49.08	49.72	56.24	51.99	53.87	50.63</li>
</ul>
</li>
<li>
<p><a class="link" href="https://www.tanksandtemples.org/leaderboard/?table_0-page=2#:~:text=44.75-,Point%2DMVSNet,-390.50"  target="_blank" rel="noopener"
    >Point-MVSNet</a>
390.50  48.27  N.A.  61.79  41.15  34.20  50.79  51.97  50.85  52.38  43.06
didn&rsquo;t exhibit the T&amp;T results in their <a class="link" href="https://arxiv.org/abs/1908.04422"  target="_blank" rel="noopener"
    >paper</a>.</p>
</li>
</ul>
<hr>
<h2 id="depth-map-fusion">Depth map fusion</h2>
<p>(2024-03-06)</p>
<p><a class="link" href="https://github.com/kwea123/CasMVSNet_pl/blob/a09e5ba230a18be54b9f6b1d714c3dc58acd8a00/eval.py#L259-L325"  target="_blank" rel="noopener"
    >Code-CasMVSNet_pl</a></p>
<pre class="pseudocode" data-line-number=true>\begin{algorithm}
\caption{Depth map fusion}
\begin{algorithmic}
\FOR{view=1 \TO 49}
    \STATE Read reference image
    \FOR{src=1 \TO 10}
    \STATE Warp src depth map to be seen from the ref view
    \STATE Reproject the warped dMap\_src onto dMap\_ref
    \IF {Pixel diff < 1 pix \AND depth error < 0.01}
    \STATE mask\_geo = 1
    \ENDIF
    \ENDFOR
    \STATE Average reprojected ref depth maps and images
    \STATE Unproject the mean ref depth map to point cloud in world space
\ENDFOR
\STATE Output 49 point clouds
\end{algorithmic}
\end{algorithm}
</pre>

<ul>
<li>Procedure description refer to paper <a class="link" href="https://arxiv.org/abs/1804.02505"  target="_blank" rel="noopener"
    >MVSNet sec 4.2</a></li>
</ul>
<p>(2024-05-16)</p>
<ul>
<li>
<p>As long the predicted depth is accurate, warping the source view based on the homography will result in the <strong>same scale</strong> as the ref view.</p>
<p>Therefore, the same pixel coordinate on the warped src image and the ref image correspond to a same 3D point.
In other words, the warped src view and the ref view can overlap.</p>
<p>Warping is done by sampling pixels from the source depth map according to the homography from the ref view to a src view.</p>
</li>
</ul>
<p>The fused depth map of a ref view is the average of refined depth maps
after applying the photometric and geometric constraints on each pair of the ref and a src view</p>





  
  
  
  
   
  
  
   
  
  <img src= /writenotes/model/mvs/img/MVSNet_depthMap_fusion.jpg width=>
  
  


<p>Apply the final mask on the <code>depth_est_averaged</code>, then unproject pixels on dpeth map to world space.</p>
<p>Because there are 49 views for a scan, the output .ply file is a combination of 49 point clouds.</p>
<figure><a href="https://storage1.ucsd.edu/slides/CSE152/L3_MVG.html#/title" target="blank"><img src="https://storage1.ucsd.edu/slides/CSE152/L3/MVS.svg" width="70%"/></a>
</figure>

<hr>
<p>CasMVSNet depth map fusion process: <a id="aligned"></a></p>





  
  
  
  
   
  
  
   
  
  <img src= /writenotes/model/mvs/img/CasMVSNet_depthMap_fuse.jpg width=>
  
  


<details><summary> Plotting code snippet </summary>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</span></span><span class="line"><span class="cl"><span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span><span class="n">dpi</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">image_ref</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&#34;./image_ref.npy&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">image_ref</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&#34;image_ref: scan_1 view0&#34;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div></details>
<ul>
<li>
<p>With substituing the predicted depth into homography, the warped source image <strong>aligns</strong> with the reference image pretty much.</p>
</li>
<li>
<p>Seen from the valid-depth mask, some highlight spots are missed.</p>
</li>
<li>
<p>CasMVSNet-pl averaged the color of 10 source views that have performed homography transformation.
(<a class="link" href="https://github.com/kwea123/CasMVSNet_pl/tree/master/evaluations#depth-fusion-description"  target="_blank" rel="noopener"
    >desc</a>)</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="nv">image_refined_</span> <span class="o">=</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  np.sum<span class="o">(</span>image_src2refs, 0<span class="o">)</span>/np.expand_dims<span class="o">((</span>mask_geo_sum+1<span class="o">)</span>, -1<span class="o">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Whereas, MVSNet-pytorch only casts the color of the refernce view.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="nv">color</span> <span class="o">=</span> ref_img<span class="o">[</span>1:-16:4, 1::4, :<span class="o">][</span>valid_points<span class="o">]</span>  <span class="c1"># hardcoded for DTU dataset</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>

</section>


    <footer class="article-footer">
    
    <section class="article-tags">
        
            <a href="/tags/mvg/">MVG</a>
        
            <a href="/tags/points/">Points</a>
        
    </section>


    </footer>


    
        <link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/katex@0.15.6/dist/katex.min.css"integrity="sha256-J&#43;iAE0sgH8QSz9hpcDxXIftnj65JEZgNhGcgReTTK9s="crossorigin="anonymous"
            ><script 
                src="https://cdn.jsdelivr.net/npm/katex@0.15.6/dist/katex.min.js"integrity="sha256-InsNdER1b2xUewP&#43;pKCUJpkhiqwHgqiPXDlIk7GzBu4="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/katex@0.15.6/dist/contrib/auto-render.min.js"integrity="sha256-y39Mpg7V3D4lhBX4x6O0bUqTV4pSrfgwEfGKfxkOdgI="crossorigin="anonymous"
                defer
                >
            </script><script>
    window.addEventListener("DOMContentLoaded", () => {
        renderMathInElement(document.querySelector(`.article-content`), {
            delimiters: [
                { left: "$$", right: "$$", display: true },
                { left: "$", right: "$", display: false },
                { left: "\\(", right: "\\)", display: false },
                { left: "\\[", right: "\\]", display: true }
            ],
            ignoredClasses: ["gist"]
        });})
</script>

    

    

    
      
      <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.7/katex.min.js"
              integrity="sha512-EKW5YvKU3hpyyOcN6jQnAxO/L8gts+YdYV6Yymtl8pk9YlYFtqJgihORuRoBXK8/cOIlappdU6Ms8KdK6yBCgA=="
              crossorigin="anonymous" referrerpolicy="no-referrer">
      </script>
    
      
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pseudocode@2.4.1/build/pseudocode.min.css">
      <script src="https://cdn.jsdelivr.net/npm/pseudocode@2.4.1/build/pseudocode.min.js">
      </script>
    
      
      <script>
        pseudocode.renderClass("pseudocode");
      </script>
    


    
    


    
    

</article>



    

    

<aside class="related-content--wrapper">
    <h2 class="section-title">Related content</h2>
    <div class="related-content">
        <div class="flex article-list--tile">
            
                
<article class="has-image">
    <a href="/writenotes/model/mvs/b-note-point-mvsnet/">
        
        
            <div class="article-image">
                
                    <img src="http://hansf.me/projects/PMVSNet/images/network.png" loading="lazy" data-key="" data-hash="http://hansf.me/projects/PMVSNet/images/network.png"/>
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">read: Depth - MVG | Point-MVSNet</h2>
        </div>
    </a>
</article>

            
                
<article class="has-image">
    <a href="/writenotes/model/mvs/b-note-mvsnet/">
        
        
            <div class="article-image">
                
                    <img src="https://ar5iv.labs.arxiv.org/html/1804.02505/assets/x1.png" loading="lazy" data-key="" data-hash="https://ar5iv.labs.arxiv.org/html/1804.02505/assets/x1.png"/>
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">read: Depth - MVG | MVSNet</h2>
        </div>
    </a>
</article>

            
        </div>
    </div>
</aside>

     
    
        
    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
            2020 - 
        
        2024 Zichen Wang
    </section>
    
    <section class="powerby">
        
              <a href="https://creativecommons.org/licenses/by-sa/4.0/" target="_blank">CC BY-SA 4.0</a>
   <br/>
        Built with <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> <br />
        Theme <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.16.0">Stack</a></b> designed by <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a>
    </section>
</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css"crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css"crossorigin="anonymous"
            >

            </main>
        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js"integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z&#43;KMkF24hUW8WePSA9HM="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/ts/main.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

    </body>
</html>
