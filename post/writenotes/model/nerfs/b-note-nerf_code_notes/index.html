<!DOCTYPE html>
<html lang="en-us" dir="ltr">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content="References:\nNeRFæºç è§£è¯»-dezeming | dezeming.top Searched by æ€ç”Ÿä¸¸å­¦ai in DDG(250410) (2022-07-20)\nHyperparameters N_rand æˆ– batch_rays æ˜¯ä¸€ä¸ª epoch/iteration è¦è®­ç»ƒçš„å…‰çº¿, no_batching æ˜¯æ¯ epoch åªä»ä¸€å¼ å›¾ä¸­é€‰åƒç´ è®­ç»ƒï¼Œè‹¥ä¸º False åˆ™æ‰“ä¹±æ‰€æœ‰è®­ç»ƒå›¾åƒçš„åƒç´ ï¼ˆéƒ½ä¸testé˜¶æ®µæ¸²æŸ“å…¨å›¾æ— å…³ï¼‰ã€‚\nllff ä½¿ç”¨äº†batchingï¼Œæ¯ä¸€ä¸ª epoch ä½¿ç”¨çš„(4096)å…‰çº¿æ¥è‡ªæ‰€æœ‰è®­ç»ƒå›¾åƒï¼› è€Œ blender ä¸åš batchingï¼Œæ¯ epoch åªä»ä¸€å¼ å›¾ä¸­å–å…‰çº¿ï¼Œæ‰€ä»¥ N_rand ä¹Ÿè¾ƒå°(1024)ï¼Œ æœ‰äººè¯´æ˜¯å› ä¸º blender åŒ…å« 360 åº¦çš„å›¾ç‰‡ï¼Œå¯èƒ½ä¼šé‡‡åˆ°å®Œå…¨å¯¹ç«‹çš„ä¸¤æ¡å…‰çº¿ï¼ˆä¸€ä¸ªä»æ­£é¢çœ‹ï¼Œä¸€ä¸ªä»åé¢çœ‹ï¼‰ï¼Œå¯èƒ½å½±å“è®­ç»ƒï¼ˆå½±å“densityåˆ†å¸ƒï¼Ÿï¼‰ã€‚ NeRFæºç è§£æ-ä»€åº¦å­¦ä¹ \nN_samples å†³å®šæ¯æ¡å…‰çº¿ä¸Šçš„é‡‡æ ·ç‚¹æ•°é‡å’ŒNeRFçš„æ¸²æŸ“è´¨é‡;\nchunk æ˜¯ model ä¸€æ¬¡è®¡ç®—çš„ rays, netchunk æ˜¯å®é™…æ¯æ¬¡è¾“å…¥ model çš„ 3D points é‡ï¼ˆæ¨¡å‹çš„ train å’Œ test éƒ½ä¸å®ƒä»¬æœ‰å…³ï¼‰ã€‚ chunk å’Œ netchunk æ˜¯ä¸¤å±‚å¾ªç¯ã€‚\n">
<title>Read: NVS - NeRF | Code Understanding</title>

<link rel='canonical' href='http://blog.zichen.uk/post/writenotes/model/nerfs/b-note-nerf_code_notes/'>

<link rel="stylesheet" href="/scss/style.min.0e95b70faf4f470dc6ba88da538ece0f8cf22d03bab371e1b345205b81899732.css"><meta property='og:title' content="Read: NVS - NeRF | Code Understanding">
<meta property='og:description' content="References:\nNeRFæºç è§£è¯»-dezeming | dezeming.top Searched by æ€ç”Ÿä¸¸å­¦ai in DDG(250410) (2022-07-20)\nHyperparameters N_rand æˆ– batch_rays æ˜¯ä¸€ä¸ª epoch/iteration è¦è®­ç»ƒçš„å…‰çº¿, no_batching æ˜¯æ¯ epoch åªä»ä¸€å¼ å›¾ä¸­é€‰åƒç´ è®­ç»ƒï¼Œè‹¥ä¸º False åˆ™æ‰“ä¹±æ‰€æœ‰è®­ç»ƒå›¾åƒçš„åƒç´ ï¼ˆéƒ½ä¸testé˜¶æ®µæ¸²æŸ“å…¨å›¾æ— å…³ï¼‰ã€‚\nllff ä½¿ç”¨äº†batchingï¼Œæ¯ä¸€ä¸ª epoch ä½¿ç”¨çš„(4096)å…‰çº¿æ¥è‡ªæ‰€æœ‰è®­ç»ƒå›¾åƒï¼› è€Œ blender ä¸åš batchingï¼Œæ¯ epoch åªä»ä¸€å¼ å›¾ä¸­å–å…‰çº¿ï¼Œæ‰€ä»¥ N_rand ä¹Ÿè¾ƒå°(1024)ï¼Œ æœ‰äººè¯´æ˜¯å› ä¸º blender åŒ…å« 360 åº¦çš„å›¾ç‰‡ï¼Œå¯èƒ½ä¼šé‡‡åˆ°å®Œå…¨å¯¹ç«‹çš„ä¸¤æ¡å…‰çº¿ï¼ˆä¸€ä¸ªä»æ­£é¢çœ‹ï¼Œä¸€ä¸ªä»åé¢çœ‹ï¼‰ï¼Œå¯èƒ½å½±å“è®­ç»ƒï¼ˆå½±å“densityåˆ†å¸ƒï¼Ÿï¼‰ã€‚ NeRFæºç è§£æ-ä»€åº¦å­¦ä¹ \nN_samples å†³å®šæ¯æ¡å…‰çº¿ä¸Šçš„é‡‡æ ·ç‚¹æ•°é‡å’ŒNeRFçš„æ¸²æŸ“è´¨é‡;\nchunk æ˜¯ model ä¸€æ¬¡è®¡ç®—çš„ rays, netchunk æ˜¯å®é™…æ¯æ¬¡è¾“å…¥ model çš„ 3D points é‡ï¼ˆæ¨¡å‹çš„ train å’Œ test éƒ½ä¸å®ƒä»¬æœ‰å…³ï¼‰ã€‚ chunk å’Œ netchunk æ˜¯ä¸¤å±‚å¾ªç¯ã€‚\n">
<meta property='og:url' content='http://blog.zichen.uk/post/writenotes/model/nerfs/b-note-nerf_code_notes/'>
<meta property='og:site_name' content='Zichen Wang'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:tag' content='NeRF' /><meta property='article:published_time' content='2022-05-17T00:00:00&#43;00:00'/><meta property='article:modified_time' content='2022-05-17T00:00:00&#43;00:00'/>
<meta name="twitter:title" content="Read: NVS - NeRF | Code Understanding">
<meta name="twitter:description" content="References:\nNeRFæºç è§£è¯»-dezeming | dezeming.top Searched by æ€ç”Ÿä¸¸å­¦ai in DDG(250410) (2022-07-20)\nHyperparameters N_rand æˆ– batch_rays æ˜¯ä¸€ä¸ª epoch/iteration è¦è®­ç»ƒçš„å…‰çº¿, no_batching æ˜¯æ¯ epoch åªä»ä¸€å¼ å›¾ä¸­é€‰åƒç´ è®­ç»ƒï¼Œè‹¥ä¸º False åˆ™æ‰“ä¹±æ‰€æœ‰è®­ç»ƒå›¾åƒçš„åƒç´ ï¼ˆéƒ½ä¸testé˜¶æ®µæ¸²æŸ“å…¨å›¾æ— å…³ï¼‰ã€‚\nllff ä½¿ç”¨äº†batchingï¼Œæ¯ä¸€ä¸ª epoch ä½¿ç”¨çš„(4096)å…‰çº¿æ¥è‡ªæ‰€æœ‰è®­ç»ƒå›¾åƒï¼› è€Œ blender ä¸åš batchingï¼Œæ¯ epoch åªä»ä¸€å¼ å›¾ä¸­å–å…‰çº¿ï¼Œæ‰€ä»¥ N_rand ä¹Ÿè¾ƒå°(1024)ï¼Œ æœ‰äººè¯´æ˜¯å› ä¸º blender åŒ…å« 360 åº¦çš„å›¾ç‰‡ï¼Œå¯èƒ½ä¼šé‡‡åˆ°å®Œå…¨å¯¹ç«‹çš„ä¸¤æ¡å…‰çº¿ï¼ˆä¸€ä¸ªä»æ­£é¢çœ‹ï¼Œä¸€ä¸ªä»åé¢çœ‹ï¼‰ï¼Œå¯èƒ½å½±å“è®­ç»ƒï¼ˆå½±å“densityåˆ†å¸ƒï¼Ÿï¼‰ã€‚ NeRFæºç è§£æ-ä»€åº¦å­¦ä¹ \nN_samples å†³å®šæ¯æ¡å…‰çº¿ä¸Šçš„é‡‡æ ·ç‚¹æ•°é‡å’ŒNeRFçš„æ¸²æŸ“è´¨é‡;\nchunk æ˜¯ model ä¸€æ¬¡è®¡ç®—çš„ rays, netchunk æ˜¯å®é™…æ¯æ¬¡è¾“å…¥ model çš„ 3D points é‡ï¼ˆæ¨¡å‹çš„ train å’Œ test éƒ½ä¸å®ƒä»¬æœ‰å…³ï¼‰ã€‚ chunk å’Œ netchunk æ˜¯ä¸¤å±‚å¾ªç¯ã€‚\n">
    <link rel="shortcut icon" href="/favicon-32x32.png" />

    </head>
    <body class="
    article-page
    ">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky ">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="Toggle Menu">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header>
        
            
            <figure class="site-avatar">
                <a href="/">
                
                    
                    
                    
                        
                        <img src="/img/avatar_hu_b598b46054b3fa80.png" width="300"
                            height="300" class="site-logo" loading="lazy" alt="Avatar">
                    
                
                </a>
                
            </figure>
            
        
        
        <div class="site-meta">
            <h1 class="site-name"><a href="/">Zichen Wang</a></h1>
            <h2 class="site-description"></h2>
        </div>
    </header><ol class="menu-social">
            
                <li>
                    <a 
                        href='https://github.com/zichen34'
                        target="_blank"
                        title="GitHub"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5" />
</svg>



                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://twitter.com/luckily1640'
                        target="_blank"
                        title="Twitter"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-twitter" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M22 4.01c-1 .49 -1.98 .689 -3 .99c-1.121 -1.265 -2.783 -1.335 -4.38 -.737s-2.643 2.06 -2.62 3.737v1c-3.245 .083 -6.135 -1.395 -8 -4c0 0 -4.182 7.433 4 11c-1.872 1.247 -3.739 2.088 -6 2c3.308 1.803 6.913 2.423 10.034 1.517c3.58 -1.04 6.522 -3.723 7.651 -7.742a13.84 13.84 0 0 0 .497 -3.753c-.002 -.249 1.51 -2.772 1.818 -4.013z" />
</svg>



                        
                    </a>
                </li>
            
        </ol><ol class="menu" id="main-menu">
        
        
        
        <li >
            <a href='/post/writenotes/' >
                
                
                
                <span>WriteNotes</span>
            </a>
        </li>
        
        
        <li >
            <a href='/aboutme/' >
                
                
                
                <span>About</span>
            </a>
        </li>
        
        
        <li >
            <a href='/page/search/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="10" cy="10" r="7" />
  <line x1="21" y1="21" x2="15" y2="15" />
</svg>



                
                <span>Search</span>
            </a>
        </li>
        
        <li class="menu-bottom-section">
            <ol class="menu">

                
                    <li id="dark-mode-toggle">
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="8" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="16" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <span>Dark Mode</span>
                    </li>
                
            </ol>
        </li>
    </ol>
</aside>

    <aside class="sidebar right-sidebar sticky">
        
            
                
    <section class="widget archives">
        <div class="widget-icon">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



        </div>
        <h2 class="widget-title section-title">Table of contents</h2>
        
        <div class="widget--toc">
            <nav id="TableOfContents">
  <ol>
    <li><a href="#hyperparameters">Hyperparameters</a></li>
    <li><a href="#oom">OOM</a></li>
    <li><a href="#inverse-transform-sampling">Inverse transform sampling</a></li>
    <li><a href="#pe-has-no-Ï€">PE has no Ï€</a></li>
    <li><a href="#use-t-to-sample-points">Use t to sample points</a></li>
    <li><a href="#t-or-z-sampling">t or z sampling</a></li>
    <li><a href="#rays-in-nerf">Rays in NeRF</a></li>
    <li><a href="#bdsmin">bds.min</a></li>
    <li><a href="#get_rays">get_rays()</a></li>
    <li><a href="#dist">dist</a></li>
    <li><a href="#errors">Errors</a>
      <ol>
        <li><a href="#mogrify-error">mogrify error</a></li>
        <li><a href="#imread_v2-error">imread_v2() error</a></li>
        <li><a href="#blas-gemm-launch-failed">Blas GEMM launch failed</a></li>
      </ol>
    </li>
    <li><a href="#lego-ply">Lego ply</a></li>
  </ol>
</nav>
        </div>
    </section>

            
        
    </aside>


            <main class="main full-width">
    <article class="main-article">
    <header class="article-header">

    <div class="article-details">
    
    <header class="article-category">
        
            <a href="/categories/read/" style="background-color: #2a9d8f; color: #fff;">
                Read
            </a>
        
    </header>
    

    <div class="article-title-wrapper">
        <h2 class="article-title">
            <a href="/post/writenotes/model/nerfs/b-note-nerf_code_notes/">Read: NVS - NeRF | Code Understanding</a>
        </h2>
    
        
    </div>

    
    
    
    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">May 17, 2022</time>
            </div>
        

        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



                <time class="article-time--reading">
                    11 minute read
                </time>
            </div>
        
    </footer>
    

    
</div>

</header>

    <section class="article-content">
    
<section class="toc toc--inline">
    <h2 class="">Table of contents</h2>
    <div class="" >
        <nav id="TableOfContents">
  <ol>
    <li><a href="#hyperparameters">Hyperparameters</a></li>
    <li><a href="#oom">OOM</a></li>
    <li><a href="#inverse-transform-sampling">Inverse transform sampling</a></li>
    <li><a href="#pe-has-no-Ï€">PE has no Ï€</a></li>
    <li><a href="#use-t-to-sample-points">Use t to sample points</a></li>
    <li><a href="#t-or-z-sampling">t or z sampling</a></li>
    <li><a href="#rays-in-nerf">Rays in NeRF</a></li>
    <li><a href="#bdsmin">bds.min</a></li>
    <li><a href="#get_rays">get_rays()</a></li>
    <li><a href="#dist">dist</a></li>
    <li><a href="#errors">Errors</a>
      <ol>
        <li><a href="#mogrify-error">mogrify error</a></li>
        <li><a href="#imread_v2-error">imread_v2() error</a></li>
        <li><a href="#blas-gemm-launch-failed">Blas GEMM launch failed</a></li>
      </ol>
    </li>
    <li><a href="#lego-ply">Lego ply</a></li>
  </ol>
</nav>

    </div>
</section>



    
    
    <p><strong>References</strong>:</p>
<ol>
<li><a id=""></a>
<a class="link" href="https://dezeming.top/wp-content/uploads/2024/08/nerf-pytorch-%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB%E5%88%86%E6%9E%90.pdf"  target="_blank" rel="noopener"
    >NeRFæºç è§£è¯»-dezeming | dezeming.top</a>
<small>
<ul>
<li>Searched by <code>æ€ç”Ÿä¸¸å­¦ai</code> in
<a class="link" href="https://duckduckgo.com/?q=%E6%9D%80%E7%94%9F%E4%B8%B8%E5%AD%A6ai&amp;ia=web"  target="_blank" rel="noopener"
    >DDG</a>(250410)
</small></li>
</ul>
</li>
</ol>
<hr>
<p>(2022-07-20)</p>
<h2 id="hyperparameters">Hyperparameters
</h2><ol>
<li>
<p><a class="link" href="https://github.com/bmild/nerf/blob/18b8aebda6700ed659cb27a0c348b737a5f6ab60/run_nerf.py#L764"  target="_blank" rel="noopener"
    ><code>N_rand</code> æˆ– <code>batch_rays</code></a>
æ˜¯ä¸€ä¸ª epoch/iteration è¦è®­ç»ƒçš„å…‰çº¿,
<a class="link" href="https://github.com/bmild/nerf/blob/18b8aebda6700ed659cb27a0c348b737a5f6ab60/run_nerf.py#L776-L780"  target="_blank" rel="noopener"
    ><code>no_batching</code></a>
æ˜¯æ¯ epoch åªä»ä¸€å¼ å›¾ä¸­é€‰åƒç´ è®­ç»ƒï¼Œè‹¥ä¸º <a class="link" href="https://github.com/bmild/nerf/blob/18b8aebda6700ed659cb27a0c348b737a5f6ab60/run_nerf.py#L718-L744"  target="_blank" rel="noopener"
    >False</a>
åˆ™æ‰“ä¹±æ‰€æœ‰è®­ç»ƒå›¾åƒçš„åƒç´ ï¼ˆ<strong>éƒ½ä¸testé˜¶æ®µæ¸²æŸ“å…¨å›¾æ— å…³</strong>ï¼‰ã€‚</p>
<p><a class="link" href="https://github.com/bmild/nerf/blob/master/config_fern.txt"  target="_blank" rel="noopener"
    >llff</a>
ä½¿ç”¨äº†batchingï¼Œæ¯ä¸€ä¸ª epoch ä½¿ç”¨çš„(4096)å…‰çº¿æ¥è‡ªæ‰€æœ‰è®­ç»ƒå›¾åƒï¼›
è€Œ <a class="link" href="https://github.com/bmild/nerf/blob/master/config_lego.txt"  target="_blank" rel="noopener"
    >blender</a>
ä¸åš batchingï¼Œæ¯ epoch åªä»ä¸€å¼ å›¾ä¸­å–å…‰çº¿ï¼Œæ‰€ä»¥ <code>N_rand</code> ä¹Ÿè¾ƒå°(1024)ï¼Œ
æœ‰äººè¯´æ˜¯å› ä¸º blender åŒ…å« 360 åº¦çš„å›¾ç‰‡ï¼Œå¯èƒ½ä¼šé‡‡åˆ°å®Œå…¨å¯¹ç«‹çš„ä¸¤æ¡å…‰çº¿ï¼ˆä¸€ä¸ªä»æ­£é¢çœ‹ï¼Œä¸€ä¸ªä»åé¢çœ‹ï¼‰ï¼Œå¯èƒ½å½±å“è®­ç»ƒï¼ˆå½±å“densityåˆ†å¸ƒï¼Ÿï¼‰ã€‚
<a class="link" href="https://www.bilibili.com/video/BV1d841187tn?t=674.6"  target="_blank" rel="noopener"
    >NeRFæºç è§£æ-ä»€åº¦å­¦ä¹ </a></p>
</li>
<li>
<p><a class="link" href="https://github.com/bmild/nerf/blob/18b8aebda6700ed659cb27a0c348b737a5f6ab60/run_nerf.py#L181-L189"  target="_blank" rel="noopener"
    ><code>N_samples</code></a>
å†³å®šæ¯æ¡å…‰çº¿ä¸Šçš„é‡‡æ ·ç‚¹æ•°é‡å’ŒNeRFçš„æ¸²æŸ“è´¨é‡;</p>
</li>
<li>
<p><a class="link" href="https://github.com/bmild/nerf/blob/18b8aebda6700ed659cb27a0c348b737a5f6ab60/run_nerf.py#L246-L250"  target="_blank" rel="noopener"
    ><code>chunk</code></a>
æ˜¯ model ä¸€æ¬¡è®¡ç®—çš„ rays,
<a class="link" href="https://github.com/bmild/nerf/blob/18b8aebda6700ed659cb27a0c348b737a5f6ab60/run_nerf.py#L42"  target="_blank" rel="noopener"
    ><code>netchunk</code></a>
æ˜¯å®é™…æ¯æ¬¡è¾“å…¥ model çš„ 3D <strong>points</strong> é‡ï¼ˆæ¨¡å‹çš„ train å’Œ test éƒ½ä¸å®ƒä»¬æœ‰å…³ï¼‰ã€‚ chunk å’Œ netchunk æ˜¯ä¸¤å±‚å¾ªç¯ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Select N_rand rays for training. </span>
</span></span><span class="line"><span class="cl"><span class="c1"># Or input all rays in an image (H,W) for rendering</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">render</span><span class="p">(</span><span class="n">rays</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">  <span class="k">for</span> <span class="n">each</span> <span class="n">ray</span><span class="o">-</span><span class="n">chunk</span> <span class="ow">in</span> <span class="n">rays</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">ret</span> <span class="o">=</span> <span class="n">render_rays</span><span class="p">(</span><span class="n">ray</span><span class="o">-</span><span class="n">chunk</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">render_rays</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">      <span class="c1"># Sampling 3D points and do PE</span>
</span></span><span class="line"><span class="cl">      <span class="k">for</span> <span class="n">each</span> <span class="n">point</span><span class="o">-</span><span class="n">netchunk</span> <span class="ow">in</span> <span class="nb">all</span> <span class="n">points</span> <span class="n">of</span> <span class="n">this</span> <span class="n">ray</span><span class="o">-</span><span class="n">chunk</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">raw</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">model</span><span class="p">(</span><span class="n">pts</span><span class="o">-</span><span class="n">netchunk</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">      <span class="k">return</span> <span class="n">tf</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">raw</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Collect ret for each ray-chunk</span>
</span></span><span class="line"><span class="cl">    <span class="n">ret_list</span><span class="o">.</span><span class="n">append</span><span class="p">[</span><span class="n">ret</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">  <span class="c1"># All rays are composed:</span>
</span></span><span class="line"><span class="cl">  <span class="n">all_ret</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">ret_list</span><span class="p">)</span>   <span class="c1"># for N_rand or (H,W) rays</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>chunk</code>ï¼ˆå…‰çº¿ï¼‰å’Œ<code>netchunk</code>ï¼ˆç‚¹ï¼‰å¯ä¾æ˜¾å­˜å¤§å°è°ƒæ•´ã€‚å½“ <code>N_rand</code> ç›¸åŒï¼Œè€Œ <code>netchunk</code> ä¸åŒï¼Œæ›²çº¿å‡ ä¹é‡å (~0.03)ï¼Œåªå½±å“è®­ç»ƒé€Ÿåº¦ã€‚</p>
<p>è™½é¢„è®¾ <code>chunk</code> =1024x32ï¼Œä½† <code>N_rand (batch_rays)</code> é¢„è®¾åªæœ‰1024ï¼Œ
æ‰€ä»¥å®é™…è¾“å…¥ model çš„å…‰çº¿æ˜¯ 1024ï¼Œåˆ™è¾“å…¥ coarse model çš„æ•°æ®ç‚¹æœ‰1024x64ä¸ªï¼ˆçœŸæ­£çš„&rsquo;batch_size&rsquo;ï¼‰ï¼Œ
<del>å½“é€šè¿‡attention layeræ—¶ï¼Œè¦åˆ›å»ºä¸€ä¸ª (65536,128,128) å¼ é‡è¦ç”¨1.07G</del>
ï¼ˆä¸ï¼Œtf å…ˆåˆ›å»ºè®¡ç®—å›¾ï¼ŒPE å‡½æ•°å äº†8ä¸ªGï¼Œå…¶ä»–çš„æ˜¾å­˜åº”è¯¥æ˜¯è¿”å›å€¼(tensor)å çš„ï¼‰</p>
</li>
<li>
<p>ndc åœ¨ <a class="link" href="https://github.com/bmild/nerf/blob/18b8aebda6700ed659cb27a0c348b737a5f6ab60/run_nerf.py#L260-L264"  target="_blank" rel="noopener"
    ><code>render()</code></a> ä¸­é»˜è®¤ä¸º <code>True</code>ï¼Œ
åªæœ‰å½“æ•°æ®é›†ä¸æ˜¯ llff ç±»å‹ï¼Œæˆ–æŒ‡å®šä¸ä½¿ç”¨ ndcï¼ˆ<code>--no_ndc</code>ï¼‰æ—¶ï¼Œå‚æ•°å­—å…¸ä¼šæ·»åŠ ä¸€é¡¹<code>ndc=False</code>ã€‚</p>
</li>
<li>
<p><a class="link" href="https://github.com/bmild/nerf/blob/18b8aebda6700ed659cb27a0c348b737a5f6ab60/run_nerf.py#L182-L188"  target="_blank" rel="noopener"
    >lindisp = False</a>
æ˜¯å¯¹æ·±åº¦ï¼ˆä¸–ç•Œç©ºé—´:[near,far] <strong>æˆ–è€…</strong> ndc ç©ºé—´:[0,1]ï¼‰çº¿æ€§é‡‡æ ·ï¼›
ä¸º <code>True</code> åˆ™å¯¹ 1/depth çº¿æ€§é‡‡æ ·</p>
</li>
<li>
<p><a class="link" href="https://github.com/bmild/nerf/blob/18b8aebda6700ed659cb27a0c348b737a5f6ab60/run_nerf.py#L535-L536"  target="_blank" rel="noopener"
    ><code>testskip</code></a>
ä¸å½±å“llff, ä¹Ÿä¸å½±å“ train é›†ï¼ˆé€å¼ è®­ç»ƒï¼‰ï¼Œè·‘ val é›†å’Œ test é›†ä¼šè·³è¿‡å›¾ç‰‡ã€‚</p>
</li>
<li>
<p><code>factor</code>æ˜¯ llff æ•°æ®é›†åœ¨ <a class="link" href="https://github.com/bmild/nerf/blob/18b8aebda6700ed659cb27a0c348b737a5f6ab60/run_nerf.py#L588-L590"  target="_blank" rel="noopener"
    ><code>load_llff_data()</code></a>
æ—¶çš„ shrink å€æ•°ï¼Œ
<a class="link" href="https://github.com/bmild/nerf/blob/18b8aebda6700ed659cb27a0c348b737a5f6ab60/run_nerf.py#L615-L617"  target="_blank" rel="noopener"
    ><code>half_res</code></a>
å½±å“ blender(å’ŒdeepVoxel)æ•°æ®é›†ï¼›
<a class="link" href="https://github.com/bmild/nerf/blob/18b8aebda6700ed659cb27a0c348b737a5f6ab60/run_nerf.py#L339-L347"  target="_blank" rel="noopener"
    ><code>render_factor</code></a>
æ˜¯ test é˜¶æ®µ(<code>render_path()</code>)çš„æ¸²æŸ“åˆ†è¾¨ç‡</p>
</li>
<li>
<p><code>random_seed</code> åœ¨ test é˜¶æ®µä¸èµ·ä½œç”¨(<a class="link" href="https://github.com/bmild/nerf/blob/18b8aebda6700ed659cb27a0c348b737a5f6ab60/run_nerf.py#L430-L433"  target="_blank" rel="noopener"
    >perturb=False, raw_noise_std=0</a>)ã€‚
åœ¨train æ—¶ï¼Œ(<code>use_batching</code>) ä¼š <a class="link" href="https://github.com/bmild/nerf/blob/18b8aebda6700ed659cb27a0c348b737a5f6ab60/run_nerf.py#L741-L742"  target="_blank" rel="noopener"
    >æ‰“ä¹±</a> æ‰€æœ‰åƒç´ ï¼Œ
(<code>no_batching</code>)ä¼š <a class="link" href="https://github.com/bmild/nerf/blob/18b8aebda6700ed659cb27a0c348b737a5f6ab60/run_nerf.py#L778"  target="_blank" rel="noopener"
    >éšæœº</a>
é€‰å›¾ç‰‡å’Œåƒç´ , åœ¨ density ä¸ŠåŠ éšæœº noiseï¼Œåœ¨å…‰çº¿é‡‡æ ·æ—¶åŠ å…¥éšæœº perturbã€‚</p>
</li>
<li>
<p><code>perturb</code> å’Œ <code>raw_noise_std</code> åœ¨ test (<code>--render_only</code>, <code>render_path()</code>) æ¸²æŸ“é˜¶æ®µéƒ½æ˜¯0ã€‚</p>
</li>
</ol>
<hr>
<h2 id="oom">OOM
</h2><p>3 similar variables:</p>
<ol>
<li>
<p><code>N_rand</code> is the #rays used for 1 &ldquo;epoch&rdquo; to train</p>
</li>
<li>
<p><code>chunk</code> is the #rays to do <code>render_rays()</code> in a <code>for</code> loop, where points will be sampled to do positional embedding (fine stage has double pts to do PE.),</p>
<ul>
<li>
<p>The <code>embedded_fn()</code> in coarse stage takes 2G meomery;
The <code>embedded_dirs()</code> in coarse stage takes 2G;
And the fine stage takes another 4G.
NeRF model takes 357 MB.</p>
</li>
<li>
<p>Dict <code>all_ret</code> contains all the returend values from model.
In the 12th iteration of <code>render_rays()</code> after coarse stage, VRAM becomes 10763 MB from 8465 MB and then OOM, where I returned 3 additional tensors: <code>pts</code>, <code>viewdirs</code>, <code>z_vals</code>.
So the return value seems to occupy memory as well.</p>
</li>
<li>
<p>But if keeping the original settings where fewer tensors are returned, it becomes 10763 MB when finishing the ray-chunk <code>for</code> loop (32768 ray x 23 chunks) in <code>batchify_rays()</code>.</p>
</li>
<li>
<p>Memory change: 485 MB â®• 2277 MB â®• 4369 MB â®• 8465 MB</p>
</li>
</ul>
</li>
<li>
<p><code>netchunk</code> is the #pts fed into model.</p>
</li>
</ol>
<p><code>retraw</code> is one of the reasons:</p>
<ul>
<li>With setting <code>--render_only</code> and <code>--factor=4</code>, if <code>retraw=True</code>, OOM occurs at the line <code>all_ret = {k: tf.concat(all_ret[k], 0) for k in all_ret}</code> in <code>batchify_ray()</code>.
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">rgb</span><span class="p">,</span> <span class="n">disp</span><span class="p">,</span> <span class="n">acc</span><span class="p">,</span> <span class="n">extras</span> <span class="o">=</span> <span class="n">render</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">H</span><span class="p">,</span> <span class="n">W</span><span class="p">,</span> <span class="n">focal</span><span class="p">,</span> <span class="n">chunk</span><span class="o">=</span><span class="n">chunk</span><span class="p">,</span> <span class="n">c2w</span><span class="o">=</span><span class="n">c2w</span><span class="p">[:</span><span class="mi">3</span><span class="p">,</span> <span class="p">:</span><span class="mi">4</span><span class="p">],</span> <span class="n">retraw</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">render_kwargs</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div>This shows that the returned values indeed take some memory.</li>
</ul>
<hr>
<p>(2022-12-26)</p>
<h2 id="inverse-transform-sampling">Inverse transform sampling
</h2><p><code>sample_pdf(z_vals_mid, color_weights[...,1:-1],N_importance,)</code> <a class="link" href="https://github.com/bmild/nerf/blob/18b8aebda6700ed659cb27a0c348b737a5f6ab60/run_nerf_helpers.py#L183"  target="_blank" rel="noopener"
    >code</a></p>
<ul>
<li>
<p>PDF is the proportion of the color-weight of a point to the sum of all weights on a ray.
Each point has a ratio indicating how much of its color contributes to the pixel color.
(They exclueded the start and end pts, and may only focus on the distribution of the middle part.)</p>
</li>
<li>
<p>CDF tells how much the color has been rendered up to the current point.
The input of CDF is the color-weight of a point, and its output is the cumulative weight from <code>ro</code> to that point. The weights will be accumulated to 1.
So coarse net learns the weights CDF roughly. And fine sampling is based on the CDF increment.</p>
</li>
<li>
<p>(When testing) <code>N_importance</code> points <code>u</code> are selected evenly from [0,1] and they will fall into buckets spaced apart by CDFs of coarse points.
The percentage of the position of <code>u</code> between the coarse point below and above it determines the distance marching from its corresponding left-neighbor z_vals_mid.
The marching distance of a fine pts <code>z</code> is proportional to the increment of cdf.</p>
</li>
<li>
<p>When the CDF rises faster, there are more samples because the steep slope makes many <code>u</code>s fall together.</p>
<p><img src="/post/writenotes/model/nerfs/b-note-nerf_code_notes/nerf_cdf.png"
	width="1329"
	height="1049"
	
	loading="lazy"
	
		alt="img"
	
	
		class="gallery-image" 
		data-flex-grow="126"
		data-flex-basis="304px"
	
></p>
<p>In the above figure, the vertical coordiantes are the uniformly sampled <code>u</code>.
Horizontal x-ticks are coarse samples on a ray.
Green markers <code>|</code> are midpoints of coarse samples&rsquo; z.
Red points are fine samples.
Red points are all start from a midpoint and march a distance which is proportional to the cdf increment of its corresponding <code>u</code>.</p>
</li>
<li>
<p><code>tf.searchsorted(seq, values, side)</code> returns the bin-index for each value. <code>seq</code> defines a series of bins, and <code>values</code> are assigned to bin-indices based on the edges listed in seq. <code>side</code> indicates whether the index of a bin is marked by its left or right edge.
For example: edges = [-1, 3.3, 9.1, 10.0]; values = [0.0, 4.1, 12.0], return array([1,2,4]) <a class="link" href="https://www.tensorflow.org/api_docs/python/tf/searchsorted"  target="_blank" rel="noopener"
    >more</a></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">    0         1                2    3        4
</span></span><span class="line"><span class="cl">â€”â€”â€”â€”|â€”â€”â€”â—â€”â€”â€”â€”â€”|â€”â€”â€”â€”â—â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”|â€”â€”â€”â€”|â€”â€”â€”â€”â—â€”â€”â€”â€”
</span></span><span class="line"><span class="cl">   -1   0    3.3  4.1         9.1   10   12
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
<hr>
<p>(2022-06-15)</p>
<h2 id="pe-has-no-Ï€">PE has no Ï€
</h2><p><a class="link" href="https://github.com/bmild/nerf/issues/12"  target="_blank" rel="noopener"
    >(pi in positional embedding? #12)</a></p>
<p>ä¸–ç•Œåæ ‡ç³»ä¸‹çš„ zï¼ˆé€šè¿‡ projectmatrix çš„ç¬¬3è¡Œï¼‰ä» (-near,-âˆ) çš„èŒƒå›´ç¼©æ”¾åˆ°äº†ndcåæ ‡çš„[-1,1]ï¼Œx,yå¹¶æ²¡æœ‰å‚ä¸zçš„ç¼©æ”¾ï¼Œx,yæ˜¯ä¾æ®å±å¹•å¤§å°ç¼©æ”¾çš„ï¼Œå¦‚æœ scene ä¸èƒ½è¢«ä¸€ä¸ªå±å¹•è£…ä¸‹ï¼ˆä¸€å¹…imageæ²¡æœ‰æŠŠsceneæ‹å…¨ï¼‰ï¼Œå±å¹•å¤–çš„ç‚¹çš„åæ ‡æ˜¯åœ¨[-1,1]èŒƒå›´å¤–çš„ï¼šæ¯”å¦‚ scene çš„èŒƒå›´æ˜¯[-1.5, 1.5]ï¼Œç„¶ååœ¨embedæ—¶ä¹˜ä¸ŠÏ€ï¼Œåˆ™æœ€ä½é¢‘æ—¶çš„å®šä¹‰åŸŸä¸º [-1.5Ï€, 1.5Ï€]ï¼Œå› ä¸ºå‘¨æœŸæ€§ï¼Œå¤šä¸ªxå¯èƒ½å¯¹åº”åŒä¸€ä¸ªyï¼Œå¯¼è‡´é‡å¤åµŒå…¥ï¼Œæ‰€ä»¥å†ç¼©æ”¾ä¸€ä¸ªÏ€ï¼Œå®šä¹‰åŸŸå˜ä¸º[-1.5,1.5]ï¼Œåœ¨è¿™æ®µåŒºé—´ä¸Šæ˜¯å•è°ƒçš„ï¼Œä¸åŒçš„xè¢«ç¼–ç åçš„å€¼æ˜¯ä¸åŒçš„ã€‚
<a class="link" href="https://www.bilibili.com/video/BV1a44y1V7KR"  target="_blank" rel="noopener"
    >nerfä»£ç åˆ†äº«-çˆ±ç¡è§‰çš„äººäºº-bili</a></p>
<p><img src="/post/writenotes/model/nerfs/b-note-nerf_code_notes/nerf_scale_PosEnc.png"
	width="896"
	height="442"
	
	loading="lazy"
	
		alt="img"
	
	
		class="gallery-image" 
		data-flex-grow="202"
		data-flex-basis="486px"
	
></p>
<hr>
<p>(2022-06-15)</p>
<h2 id="use-t-to-sample-points">Use t to sample points
</h2><p>ä½¿ç”¨ä¸­é—´é‡ t æ˜¯ä¸ºäº†ç»Ÿä¸€ LLFF åœºæ™¯å’Œ blender åœºæ™¯å¯¹å…‰çº¿é‡‡æ ·çš„ä»£ç ï¼ˆllff çš„å…‰çº¿é•¿åº¦zâˆˆ[0,1]ï¼Œblenderçš„å…‰çº¿é•¿åº¦zâˆˆ[near,far]ï¼‰ã€‚</p>
<p>blenderåœºæ™¯è¾¹ç•Œæœ‰é™å¯ä»¥ç›´æ¥å¯¹å…‰çº¿é•¿åº¦é‡‡æ ·ï¼Œä½†æ˜¯ llff åœºæ™¯å…‰çº¿æ— é™é•¿ï¼ˆç›´æ¥é‡‡ç‚¹æ•ˆæœä¸å¥½ï¼Ÿï¼‰ï¼Œ
éœ€è¦å…ˆå°†åœºæ™¯çš„ä¸–ç•Œç³»å˜æ¢ä¸º NDC ç³»ï¼ˆåªå¯¹ llff åœºæ™¯æœ‰æ•ˆï¼‰ï¼Œå·¦ä¹˜ projection matrix ä½¿ä¸–ç•Œç³»çš„ z æ–¹å‘è¾¹ç•Œåæ ‡ [-near,-far] å˜ä¸º [-1,1]ã€‚</p>
<p>åˆ™ä¸–ç•Œç³»ä¸­çš„raysè¡¨è¾¾å¼: ğ«=ğ¨+tğ å˜æˆäº† ğ«=ğ¨&rsquo;+t&rsquo;ğ&rsquo; (èµ·ç‚¹ğ¨&rsquo;å’Œæ–¹å‘ğ&rsquo;éƒ½æ˜¯near,farçš„å‡½æ•°)ï¼›
ä»¤ğ¨&rsquo;=ğ¨ï¼Œåˆ™(ä¸–ç•Œ)å…‰çº¿é•¿åº¦tâˆˆ[0,âˆ] å˜æˆ(NDC)å…‰çº¿é•¿åº¦ t&rsquo;âˆˆ[0,1] <sup><a class="link" href="https://arxiv.org/pdf/2003.08934.pdf"  target="_blank" rel="noopener"
    >é™„å½•å…¬å¼15</a></sup>ã€‚
åé¢å°±å¯ä»¥é€šè¿‡å¯¹ t&rsquo;âˆˆ[0,1] é‡‡æ ·ï¼Œæ¥å¯¹ä¸–ç•Œç³»ä¸­çš„å„æ¡å…‰çº¿é‡‡æ ·ï¼ˆä¸æ˜¯å¯¹ä¸–ç•Œç©ºé—´çš„zè½´é‡‡æ ·ï¼Œè€Œæ˜¯åœ¨å„æ¡å…‰çº¿ä¸Šé‡‡æ ·ï¼‰ã€‚</p>
<ul>
<li>
<p>åœ¨å¯¹ä¸–ç•Œå…‰çº¿åš NDC å˜æ¢å‰ï¼ŒæŠŠå„æ¡å…‰çº¿çš„èµ·ç‚¹ ğ¨ è½¬ç§»åˆ°å…¶ä¸è¿‘å¹³é¢ (z_world=-near) çš„äº¤ç‚¹å¤„ï¼Œè¿™æ ·å˜æ¢åˆ°NDCåï¼Œå…‰çº¿é•¿åº¦t&rsquo;=0 å°±å¯¹åº”ç€ -nearï¼Œåªä¼šå¯¹å„æ¡å…‰çº¿è½åœ¨z_worldâˆˆ[-near,-far]çš„éƒ¨åˆ†é‡‡æ ·ã€‚åœ¨ä»ä¸–ç•Œç³»å˜åˆ°NDCä¸­å…‰çº¿(ğ¨&rsquo;å’Œğ&rsquo;)æ—¶ï¼Œè®¤ä¸ºnearå¹³é¢åœ¨z_world=1å¤„(å‡½æ•°<code>ndc_rays()</code>çš„å‚æ•°), farå¹³é¢åœ¨ z_world=âˆ å¤„ (å…¬å¼23,24)ã€‚
(ä½œè€…åœ¨issue34è§£é‡Šè¯´:) å› ä¸ºNDCçš„zè½´æ˜¯æŒ‰ 1/depth çº¿æ€§å˜åŒ–çš„ï¼Œæ‰€ä»¥ä¸–ç•Œç³»-far=âˆæ²¡å…³ç³»ï¼ˆå˜åˆ°ndcä¸­å°±æ˜¯far=1ï¼‰ï¼Œåªä¼šç¨å¾®é™ä½é‡‡æ ·æ•ˆç‡ã€‚</p>
</li>
<li>
<p>ç¡®å®šå¥½ndcå…‰çº¿åï¼ŒæŠŠnear,faré‡æ–°èµ‹å€¼ä¸ºå…‰çº¿é•¿åº¦çš„å–å€¼èŒƒå›´ï¼ˆllff çš„NDCä¸­å…‰çº¿é•¿åº¦çš„å–å€¼èŒƒå›´åªèƒ½æ˜¯[0,1]ï¼Œè€Œblenderåœºæ™¯çš„å…‰çº¿é•¿åº¦èŒƒå›´å°±æ˜¯ä¸–ç•Œç³»çš„[near,far]ï¼‰ï¼Œç”¨äºåœ¨å„å…‰çº¿ä¸Šé‡‡æ ·ï¼Œå†æ ¹æ®å…‰çº¿å…¬å¼ğ¨&rsquo;+zâ‹…ğ&rsquo;å¾—åˆ°é‡‡æ ·ç‚¹çš„3Dåæ ‡ã€‚ï¼ˆnear,farä¸æ˜¯depthæ·±åº¦èŒƒå›´ï¼Œè€Œæ˜¯å°„çº¿é•¿åº¦ã€‚ï¼‰
<a class="link" href="https://github.com/bmild/nerf/blob/18b8aebda6700ed659cb27a0c348b737a5f6ab60/run_nerf.py#L185"  target="_blank" rel="noopener"
    >nerf code</a></p>
</li>
</ul>
<p><img src="/post/writenotes/model/nerfs/b-note-nerf_code_notes/nerf_ndc_rays.png"
	width="1678"
	height="864"
	
	loading="lazy"
	
		alt="img"
	
	
		class="gallery-image" 
		data-flex-grow="194"
		data-flex-basis="466px"
	
></p>
<p>near,faræœ¬æ¥åªæ˜¯é•¿åº¦ï¼Œåœ¨nerfä¸­ï¼Œä¸–ç•Œç³»(avg_camera)ä¸ç›¸æœºç³»zè½´é‡åˆï¼Œsceneè½åœ¨-zæ–¹å‘ï¼Œæ‰€ä»¥è¿‘è¿œè¾¹ç•Œçš„ <strong>ä¸–ç•Œåæ ‡</strong> ä¸º-near,-farï¼Œè€Œndcçš„zè½´æ–¹å‘æ˜¯ç›¸æœºè§‚æµ‹æ–¹å‘ï¼Œè¿‘è¿œå¹³é¢çš„ndcåæ ‡=-1,1ã€‚</p>
<p>(2024-07-15)</p>
<ul>
<li>æˆ‘ä¸Šé¢è¯´çš„â€œä¸–ç•Œåæ ‡ç³»â€ï¼Œåº”è¯¥æ˜¯æŒ‡é‚£ä¸ªâ€œå¹³å‡<strong>ç›¸æœº</strong>åæ ‡ç³»â€ï¼Œå› ä¸º Projection Matrix æ˜¯æŠŠç›¸æœºç³»åæ ‡å˜æ¢åˆ° clipping spaceã€‚</li>
</ul>
<hr>
<p>(2023-05-25)</p>
<h2 id="t-or-z-sampling">t or z sampling
</h2><p>When sampling points:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">pts</span> <span class="o">=</span> <span class="n">rays_o</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="kc">None</span><span class="p">,:]</span> <span class="o">+</span> <span class="n">rays_d</span><span class="p">[</span><span class="o">...</span><span class="p">,</span><span class="kc">None</span><span class="p">,:]</span> <span class="o">*</span> <span class="n">z_vals</span><span class="p">[</span><span class="o">...</span><span class="p">,:,</span><span class="kc">None</span><span class="p">]</span>  <span class="c1"># [N_rays, N_samples, 3]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>will: è¿™é‡Œrays_dè¦æ˜¯æ²¡æœ‰å½’ä¸€åŒ–ï¼Œç›´æ¥å°±æ˜¯ Ké€†*(u,v,1)ï¼Œé‚£è¿™é‡Œz_vals å°±æ˜¯åˆ°æˆåƒå¹³é¢è·ç¦»ï¼›å¦‚æœå½’ä¸€åŒ–äº†ï¼Œé‚£å°±æ˜¯åˆ°å…‰å¿ƒè·ç¦». (QQ chat 2023-05-25T04:09:00)
<img src="/post/writenotes/model/nerfs/b-note-nerf_code_notes/nerf_t_z_sampling.jpg"
	width="1810"
	height="444"
	
	loading="lazy"
	
		alt="img"
	
	
		class="gallery-image" 
		data-flex-grow="407"
		data-flex-basis="978px"
	
></p></blockquote>
<blockquote>
<p>å“ˆå“ˆ: åŸºäºæ•°æ®é›†ç»™å®šçš„æ·±åº¦ç›´æ¥æ˜ å°„ä¸‰ç»´ç‚¹ï¼Œè¿œç«¯ä¼šè†¨èƒ€ï¼ŒæŠ•å½±åˆ°zè½´ä¸Šå‡ ä½•å°±æ­£å¸¸äº†ï¼Œæ‰€ä»¥NeRFå‡ºæ¥çš„æ·±åº¦æ˜¯è§†ç‚¹åˆ°ä¸‰ç»´ç‚¹çš„è·ç¦»
<img src="/post/writenotes/model/nerfs/b-note-nerf_code_notes/qq_%E7%9F%AB%E6%AD%A3%E6%B7%B1%E5%BA%A6.jpg"
	width="730"
	height="683"
	
	loading="lazy"
	
		alt="img"
	
	
		class="gallery-image" 
		data-flex-grow="106"
		data-flex-basis="256px"
	
></p></blockquote>
<hr>
<p>(2022-06-15)</p>
<h2 id="rays-in-nerf">Rays in NeRF
</h2><p>å¯¹å…‰çº¿çš„å¤„ç†ï¼š(camera â” world (avg camera) â” ndc)</p>
<ol>
<li>
<p>æ„é€ ï¼ˆ&ldquo;ä¸–ç•Œç³»&quot;ä¸­çš„ï¼‰å…‰çº¿ï¼š<code>rays=get_rays_np(c2w) -&gt; (ro+rd, 3)</code></p>
<ul>
<li>åƒç´ ç³»(u,v) â” æˆåƒå¹³é¢ç³»(u-cx, v-cy) â” unproj2ç›¸æœºç³»(x=u-cx/f, y=-(v-cy)/f, z=-1) â” âˆ—c2wï¼ˆ&ldquo;ä¸–ç•Œç³»&rdquo;ï¼‰ï¼Œè¿™é‡Œå–å¹³å‡ç›¸æœºç³»ä½œä¸ºâ€œä¸–ç•Œç³»â€ã€‚åªæœ‰æŠŠå…‰çº¿å˜æ¢åˆ°ä¸€ä¸ªå…±åŒçš„&quot;ä¸–ç•Œç³»&quot;ä¸‹æ‰èƒ½ç”¨ä¸åŒè§†å›¾å¯¹åŒä¸€ 3D point åšä¼˜åŒ–ã€‚</li>
<li>ä¼ å…¥çš„<code>c2w</code>=poses[:,:3,:4] æ˜¯ä» <code>load_llff_data()</code>è¿”å›ï¼Œå…¶ä¸­å‡½æ•°<code>recenter_poses()</code>/<code>spherify_poses()</code>è°ƒæ•´åŸposesï¼Œè®©å®ƒä»¬èƒ½å¤ŸæŠŠç‚¹å˜æ¢åˆ°&quot;æ–°ä¸–ç•Œç³»&quot;ä¸‹ã€‚ï¼ˆNeRFä»£ç ä¸­çš„poseså…¨æ˜¯c2wå˜æ¢ï¼‰
<ol>
<li><code>avgc_2w=poses_avg(poses)</code>ï¼Œå¹³å‡ç›¸æœºç³»â”ä¸–ç•Œç³»</li>
<li><code>poses=np.linalg.inv(avgc_2w)@poses</code>ï¼Œç›¸æœºç³»â”ä¸–ç•Œç³»â”å¹³å‡ç›¸æœºç³»(&lsquo;æ–°ä¸–ç•Œç³»&rsquo;)</li>
</ol>
</li>
</ul>
</li>
<li>
<p>æ¸²æŸ“ï¼ˆä¸–ç•Œç³»ä¸­çš„ï¼‰å…‰çº¿ï¼š<code>rgb=render(batch_rays)</code></p>
<ul>
<li>ro, rd = ndc_rays(near, ro, rd)ï¼Œå…‰çº¿çš„ä¸–ç•Œåæ ‡å˜NDC</li>
<li>all_ret = batchify_rays(rays,chunk)ï¼›åœ¨<code>render_rays()</code>ä¸­ï¼Œä»NDCçš„ [near,far] é‡‡æ ·z</li>
</ul>
</li>
</ol>
<ul>
<li>
<p>ä¸ç›´æ¥ä½¿ç”¨ colmap ç”Ÿæˆçš„c2wï¼Œå› ä¸º colmap (sfm) ä¸­çš„ä¸–ç•Œç³»æ˜¯ç”±è¾“å…¥åºåˆ—çš„ç¬¬ä¸€å¸§ç¡®å®šçš„ï¼Œä½†ç¬¬ä¸€å¸§çš„æ–¹å‘æ˜¯éšæœºçš„ï¼Œä¸ä¸€å®šæ­£å¯¹sceneï¼Œåœºæ™¯å°±é‡å»ºä¸å…¨ï¼Œåé¢å¸§çš„ poses (åˆ—å‘é‡)éƒ½æ˜¯ç›¸æœºåœ¨ä¸–ç•Œç³»ä¸­çš„è¡¨ç¤º
<sup><a class="link" href="https://www.bilibili.com/video/BV1a44y1V7KR?&amp;t=960.9"  target="_blank" rel="noopener"
    >çˆ±ç¡è§‰äººäºº16:00</a></sup>ã€‚</p>
</li>
<li>
<p>ä»åƒç´ å¹³é¢æ„å»ºå‡ºçš„ rays æ˜¯æ²¿ç€ç›¸æœºç³»çš„-zè½´çš„ï¼ˆè§‚æµ‹æ–¹å‘ï¼Œå³æ™¯ç‰©åœ¨ç›¸æœºzè½´çš„èƒŒé¢ï¼‰ï¼Œä¹Ÿå°±æ˜¯NDCçš„Zè½´æ–¹å‘(ndcå‡è®¾)ï¼›æŠŠå…‰çº¿å˜åˆ°å¹³å‡ç›¸æœºç³»(ä¸–ç•Œç³»)ä¸‹åï¼Œå†å˜æ¢åˆ°NDCï¼Œåˆ™sceneå°±è½åœ¨NDCçš„æ­£åŠzè½´ä¸Šï¼ˆä¹‹åéƒ½ä½¿ç”¨ndcåæ ‡ï¼‰ã€‚
<del>å› ä¸º NDC å‡è®¾ç›¸æœºæ˜¯æ²¿ -z æ–¹å‘è§‚å¯Ÿï¼Œæ‰€ä»¥å–å„ç›¸æœºzè½´åæ–¹å‘çš„å¹³å‡ï¼Œä½œä¸ºNDCçš„zè½´æ–¹å‘ã€‚ å› ä¸ºå…‰çº¿å…ˆè¢«å˜æ¢åˆ°ä¸–ç•Œç³»ä¸‹ï¼Œå†æŠŠä¸–ç•Œç³»å˜ä¸ºNDCï¼ˆè€ŒOpenGLæ˜¯æŠŠç›¸æœºç³»å˜æ¢åˆ°ndcï¼‰ï¼Œæ‰€ä»¥ä¸–ç•Œç³»çš„zè½´ä¸NDCçš„zè½´ä¸€æ ·çœ‹å‘sceneã€‚</del>
<a class="link" href="https://github.com/bmild/nerf/issues/34"  target="_blank" rel="noopener"
    >nerf-issue#34 LLFF data preprocessing</a></p>
</li>
<li>
<p>æ±‚å¹³å‡ç›¸æœºç³»(åœ¨ä¸–ç•Œç³»ä¸‹çš„è¡¨ç¤º) <a class="link" href="https://github.com/bmild/nerf/blob/18b8aebda6700ed659cb27a0c348b737a5f6ab60/load_llff.py#L166-L178"  target="_blank" rel="noopener"
    ><code>recenter_poses</code></a>ï¼š
ç›¸æœºå…‰å¿ƒçš„åæ ‡ç›´æ¥å¯¹ç¬¬4åˆ—å–å¹³å‡å¾—åˆ°ï¼›æ—‹è½¬çŸ©é˜µRåˆ†ä¸º3ä¸ªåˆ—å‘é‡ï¼šå„ç›¸æœºzè½´å–å¹³å‡ï¼Œå†ä½¿ç”¨å³æ‰‹å®šåˆ™ç¡®å®šx,yã€‚
æŠŠ4ä¸ªåˆ—å‘é‡x,y,zè½´å’Œå…‰å¿ƒ concat èµ·æ¥å°±æ˜¯å¹³å‡ç›¸æœºç³»åœ¨ä¸–ç•Œç³»ä¸­çš„è¡¨ç¤ºï¼Œå°±æ˜¯c2wã€‚c2w æ±‚é€†å¾— w2cã€‚
åŸposes æŠŠç›¸æœºç³»ä¸­ç‚¹å˜æ¢åˆ°ä¸–ç•Œç³»ä¸‹ï¼Œå†ç”±w2cå˜æ¢åˆ°å¹³å‡ç›¸æœºç³»(â€˜æ–°ä¸–ç•Œç³»â€™)ä¸‹ã€‚</p>
<p><img src="/post/writenotes/model/nerfs/b-note-nerf_code_notes/nerf_recenter_poses.png"
	width="1507"
	height="1042"
	
	loading="lazy"
	
		alt="img"
	
	
		class="gallery-image" 
		data-flex-grow="144"
		data-flex-basis="347px"
	
>(çŸ©é˜µçš„åˆ—åæ˜¯æºç³», è¡Œåæ˜¯ç›®æ ‡ç³», å˜æ¢é¡ºåºä¸ºä»&rsquo;åˆ—&rsquo;åˆ°&rsquo;è¡Œ&rsquo;, æ¯åˆ—çš„æ„ä¹‰æ˜¯&rsquo;æº&rsquo; seen from &lsquo;ç›®æ ‡ç³»&rsquo;)</p>
</li>
<li>
<p>å¯¹poses $\begin{bmatrix}  R & t \\\ 0 & 1 \end{bmatrix}$ æ±‚é€†æ—¶ï¼ŒRè½¬ç½®ï¼Œt ä¼šæœ‰ä¸€ç‚¹å˜åŒ–ï¼Œæœ€åä¸€è¡Œè¿˜æ˜¯0001ã€‚</p>
<p>(2024-03-29)</p>
<ul>
<li>
<p>å¯¹ c2w æ±‚é€†åï¼Œw2c ä¸­çš„ t ç­‰äº $-R_{c2w}^T t_{c2w}$. For example, given a 3D point p, suppose its world-space coordinates is P.
And its camera-space coordinates is X. So, there is:</p>
$$
    \begin{bmatrix} R_{c2w} & t_{c2w} \\\ 0 & 1 \end{bmatrix} 
    \begin{bmatrix} X \\\ 1 \end{bmatrix} = \begin{bmatrix} P \\\ 1 \end{bmatrix}  \\\
    R_{c2w} X + t_{c2w} = P  \\\
    X = R_{c2w}^{-1} (P - t_{c2w})  \\\
    X = \underbrace{R_{c2w}^T}\_{R_{w2c}} P \underbrace{- R_{c2w}^T t_{c2w}}\_{t_{w2c}}
    $$</li>
</ul>
</li>
<li>
<p>doubt: rays_d = <a class="link" href="mailto:dir@c2w.T" >dir@c2w.T</a> æ˜¯æ€ä¹ˆæ¨å¯¼çš„? (c2w âˆ— dir)áµ€ = diráµ€ âˆ— c2wáµ€
<a class="link" href="https://github.com/kwea123/nerf_pl/blob/c5910f84321eb5f72e3332507b0384f1b23f51f7/datasets/ray_utils.py#L42"  target="_blank" rel="noopener"
    >nerf-pl</a></p>
</li>
</ul>
<p>(2022-05-22)</p>
<ul>
<li>
<p>doubt: C2W æ˜¯ K[R|T] çš„é€†ï¼Œcolmapç›´æ¥æ±‚å‡ºäº†ï¼Ÿå¯¹</p>
<p>c2w ä¸­çš„ [R|T] ä¸ºï¼š
</p>
$$
  \begin{array}{ccc}  \qquad \rm Xcam \quad\quad Ycam \quad\quad Zcam \quad cam\ center\\\ 
  \begin{bmatrix}
  0.989 & -0.0224 & -0.142 & -3.67 \\\ 
  -0.0272 & -0.999 & -0.0318 & -1.603 \\\ 
  -0.141 & -0.0354 & -0.989 & -0.276  \end{bmatrix}  \end{array}
  $$<ul>
<li>æ„é€  world ç³»ä¸­çš„å…‰çº¿å³ç¡®å®š ro å’Œ rdï¼šroå°±æ˜¯ cam center åœ¨worldä¸­çš„åæ ‡ï¼Œå°±ç­‰äºc2wç¬¬4åˆ— <code>ro=c2w[:3,-1]</code>ï¼Œrd æ˜¯ç”¨åƒç´ (u,v)å¯¹åº”çš„ç›¸æœºç³»åæ ‡(u,v,1)å˜æ¢åˆ°worldç³»ä¸‹çš„åæ ‡(xw,yw,zw)è¡¨ç¤º <code>rd=c2w[:3,:3]@pixels_cam_coord</code></li>
</ul>
</li>
</ul>
<h2 id="bdsmin">bds.min
</h2><ul>
<li>åœ¨loadæ•°æ®æ—¶ï¼Œç¼©æ”¾åœºæ™¯ä¸‹ç•Œ<code>bds.min()</code>å’Œå¹³ç§»å˜é‡Tï¼ˆè‡³<code>1./bd_factor</code>ï¼ŒRä¸éœ€ç¼©æ”¾ï¼‰æ˜¯ä¸ºäº†ä»¥é˜²åœºæ™¯å¤ªå¤§ï¼Œå˜æ¢åˆ° NDC æ—¶è¶…å‡º near å¹³é¢ï¼›è™½ç„¶è¿™é‡Œç¼©æ”¾åçš„è¾¹ç•Œä¸ç­‰äº nearï¼Œä½†ä¹‹ååœ¨<code>ndc_rays()</code>ä¸­ä¼šè¢«ç¼©æ”¾å› -near (-1)ã€‚<a class="link" href="" >issue#34</a></li>
</ul>
<hr>
<p>(2022-06-03)</p>
<h2 id="get_rays">get_rays()
</h2><p><code>get_rays()</code>ä»åƒç´ å¹³é¢æ„å»ºrayçš„æ–¹å‘å‘é‡dirï¼š
é¦–å…ˆæŠŠåƒç´ åæ ‡ (u,v) åæŠ•å½±åˆ°ç›¸æœºç³» (RUB) ä¸‹: (xâ‚š=(u-cx)/f, yâ‚š=-(v-cy)/f, zâ‚š=-1)ï¼Œvè½´ä¸yè½´åå‘ï¼Œå–è¿™äº›ç‚¹æ·±åº¦å€¼=-1ï¼ˆå¦‚ä¸‹å›¾ï¼‰ã€‚
å†ä¹˜ä»¥ c2w å˜æ¢åˆ° world åæ ‡ç³»ä¸‹ã€‚ä»è€Œä¸€æ¡å…‰çº¿åœ¨ä¸–ç•Œç³»ä¸­è¡¨ç¤ºä¸ºï¼šğ«=ğ¨+tğï¼‰dir ä¸çƒåæ ‡ Ï†Î¸ æ²¡æœ‰å…³ç³»ã€‚
<a class="link" href="https://github.com/bmild/nerf/issues/24"  target="_blank" rel="noopener"
    >nerf-issue#24: the direction in get_rays</a>ï¼›
<a class="link" href="https://www.bilibili.com/video/BV1a44y1V7KR?t=247.4"  target="_blank" rel="noopener"
    >çˆ±ç¡è§‰äººäºº04:07</a></p>
<p><img src="/post/writenotes/model/nerfs/b-note-nerf_code_notes/nerf_get_rays.png"
	width="972"
	height="609"
	
	loading="lazy"
	
		alt="img"
	
	
		class="gallery-image" 
		data-flex-grow="159"
		data-flex-basis="383px"
	
></p>
<ul>
<li>
<p>Colmap/OpenCVä¸­çš„ç›¸æœºåæ ‡ç³»æ˜¯ <code>[right | down | forwards]</code>ï¼Œ
ç»è¿‡LLFFå­˜å‚¨posesä¸º <code>[down|right|backwards]</code>ï¼Œ
NeRF åœ¨<code>_load_data()</code>è¯»å–åç«‹å³å˜æ¢ä¸º (OpenGLä¸­çš„ç›¸æœºç³») <code>[right | up | backwards]</code>ã€‚</p>
<p><code>poses_bounds.npy</code>æ–‡ä»¶ä¸­æ˜¯ <strong>camera-to-worldï¼</strong>(è€Œä¸æ˜¯å¤–å‚çŸ©é˜µ!) æ¯ä¸€è¡Œ17ä¸ªå€¼ï¼Œ
å‰15ä¸ªå€¼æ˜¯3x5çš„pose matrixï¼Œæœ€å2ä¸ªå€¼æ˜¯near,faråœºæ™¯è¾¹ç•Œã€‚
ä¸€ä¸ª pose matrix ç”±5ä¸ªåˆ—å‘é‡ç»„æˆï¼šcam down-axis, cam right-axis, cam back-axis, cam center, hwf(cam intrinsics)ï¼Œ
å‰3åˆ—æ˜¯ä¸–ç•Œç³»ä¸‹çš„ç›¸æœºç³»ã€‚</p>
<p><a class="link" href="https://github.com/bmild/nerf/blob/18b8aebda6700ed659cb27a0c348b737a5f6ab60/load_llff.py#L62"  target="_blank" rel="noopener"
    ><code>_load_data()</code></a>
è¿”å›çš„ poses æ˜¯ reshape åçš„(3,5,20), ç´¢å¼• poses[:,1:2] å¯¹åº”åˆ°matrixä¸­çš„ç¬¬2åˆ—ã€‚
æ‰€ä»¥åœ¨ <a class="link" href="https://github.com/bmild/nerf/blob/18b8aebda6700ed659cb27a0c348b737a5f6ab60/load_llff.py#L250"  target="_blank" rel="noopener"
    >#250è¡Œ</a>
é‡æ–°è°ƒæ•´posesçš„&quot;è¡Œ&quot;é¡ºåºï¼Œä½¿Rçš„åˆ—é¡ºåº(ç›¸æœºç³»)ä¸ºï¼š[right,up,back]ã€‚åˆåœ¨#251è¡ŒæŠŠposeså˜å›(20,3,5)
<a class="link" href="https://github.com/fyusion/llff#using-your-own-poses-without-running-colmap"  target="_blank" rel="noopener"
    >Using your own poses without running COLMAP-LLFF</a></p>
<p>åœ¨åç»­å·¥ä½œä¸­ï¼ŒæŠŠnerfä½¿ç”¨çš„posesï¼ˆç»<code>load_llff_data()</code>å¤„ç†ï¼Œä½œç”¨ä¸ºcam-to-avg_camï¼‰ï¼Œåˆå˜å›OpenCVä¸‹çš„ç›¸æœºç³»ï¼ˆæ¯”å¦‚IBRNet,GNTï¼‰ã€‚
å¦‚ä¸‹å›¾(from <a class="link" href="https://twitter.com/ziruiwang_ox/status/1515045717244624906?s=21&amp;t=oYLehxpqpcR8Xo5itM0OVA"  target="_blank" rel="noopener"
    >Zirui Wang-Twitter</a>)</p>
<p><img src="/post/writenotes/model/nerfs/b-note-nerf_code_notes/nerf_coordinate_convertion.jpg"
	width="762"
	height="272"
	
	loading="lazy"
	
		alt="img"
	
	
		class="gallery-image" 
		data-flex-grow="280"
		data-flex-basis="672px"
	
></p>
</li>
</ul>
<p>(2022-11-14)</p>
<ul>
<li>
<p>The direction of the constructed world rays <code>rays_d</code> should not be normalized to 1 when used for sampling points (where in nerf-pl is wrong <a class="link" href="https://youtu.be/sPQzudD-83c"  target="_blank" rel="noopener"
    >confess</a>).
Original nerf didn&rsquo;t normalize in <a class="link" href="https://github.com/bmild/nerf/blob/18b8aebda6700ed659cb27a0c348b737a5f6ab60/run_nerf_helpers.py#L128"  target="_blank" rel="noopener"
    >get_rays()</a>.
Because the points are sampled based on <a class="link" href="https://github.com/bmild/nerf/blob/18b8aebda6700ed659cb27a0c348b737a5f6ab60/run_nerf.py#L181-L203"  target="_blank" rel="noopener"
    >z</a>, so they locate on parallel planes.
If the directions are normalized, the plane will become a sphere.<br></p>
<p><img src="/post/writenotes/model/nerfs/b-note-nerf_code_notes/nerf_get_rays_2.png"
	width="1251"
	height="827"
	
	loading="lazy"
	
		alt="img"
	
	
		class="gallery-image" 
		data-flex-grow="151"
		data-flex-basis="363px"
	
></p>
<p>But the <code>viewdirs</code> is normalized when it used as the model input (See run_nerf.py line#306).
<code>viewdir</code> is the normalized <code>rd</code>.</p>
</li>
</ul>
<p>(2024-07-15)</p>
<ul>
<li>
<p>æŠŠç½‘ç»œè¾“å‡ºçš„ volume density è½¬æ¢æˆ alpha æ—¶ï¼ŒæŠŠé‡‡æ ·ç‚¹çš„ z åæ ‡é—´è· <code>dists</code> è½¬æ¢æˆäº†å…‰çº¿æ®µçš„ <strong>Euclidian é•¿åº¦</strong>:
<a class="link" href="https://github.com/bmild/nerf/blob/18b8aebda6700ed659cb27a0c348b737a5f6ab60/run_nerf.py#L113-L123"  target="_blank" rel="noopener"
    >z é—´è·ä¹˜ä»¥ rays_d çš„æ¨¡é•¿</a>.</p>
<p>Alpha (self-occluaionè‡ªé®æŒ¡) ä¸ <strong>å…‰çº¿æ®µé•¿åº¦</strong> æˆ<a class="link" href="https://github.com/bmild/nerf/blob/18b8aebda6700ed659cb27a0c348b737a5f6ab60/run_nerf.py#L134-L136"  target="_blank" rel="noopener"
    >æ­£æ¯”</a>.</p>
</li>
</ul>
<hr>
<h2 id="dist">dist
</h2><p><code>dists</code> are intervals between [near,far] and used for transforming the density Ïƒ (activation) to opacity Î± of each interval on the ray: Î±=(1-eâ»Ê³áµ‰Ë¡áµ˜â½â¶ á• áµˆâ±Ë¢áµ—â¾), because the opacity is proportional to distance (&ldquo;thickness&rdquo;). The dists can be equal when no perturb, so if density is high like around the surface, the opacity is close to 1. And the color coefficient: w=(1-Î±) âˆâ‚œâ‚Œâ‚áµ—â»Â¹ Î±â‚œ is monotonically decreasing, so the further a point is, the smaller its color coeff will be until 0.</p>
<ul>
<li>The derivative of color weight at the surface point tâˆ— is not zero: $dw(t^âˆ—)/dt < 0$ (see Neus proof). Hence, the minia is not on the surface.</li>
</ul>
<hr>
<h2 id="errors">Errors
</h2><p>(2023-05-13)</p>
<h3 id="mogrify-error">mogrify error
</h3><p>A new environment is created on Ubuntu 22.04. The package imagemagick is installed in the env <code>nerf</code> by checking <code>conda list</code>.
But when I debug the code in vscode, the shell <code>/bin/sh</code> cannot found the command <code>mogrify</code>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">Fixing random seed <span class="m">2201</span>
</span></span><span class="line"><span class="cl">Minifying <span class="m">64</span> ./data/nerf_llff_data/fern
</span></span><span class="line"><span class="cl">mogrify -resize 1.5625% -format png *.JPG
</span></span><span class="line"><span class="cl">/bin/sh: 1: mogrify: not found
</span></span></code></pre></td></tr></table>
</div>
</div><p>Testing in a terminal, if the env is <code>(nerf)</code>, executing the command: <code>/bin/sh -c mogrify</code> is okay and it will prompt the optional arguments.</p>
<p>But if the env is <code>(base)</code>, executing <code>/bin/sh -c mogrify</code>, the same error occurs: <code>/bin/sh: 1: mogrify: not found</code>.</p>
<ol>
<li>
<p>I found a Chinese post for the same problem. He installed imagemagick again: <code>sudo apt install imagemagick</code> <a class="link" href="https://blog.csdn.net/nguever15/article/details/123827398"  target="_blank" rel="noopener"
    >ã€NeRFã€‘åœ¨yenchenlin/nerf-pytorchä¸Šè¿è¡Œæ–°çš„æ•°æ®é›†</a></p>
</li>
<li>
<p>For this CalledProcessError <code>&quot;/bin/sh: 1: MY_COMMAND: not found&quot;</code> problem, some people suggest to create a link to /usr/bin, e.g., <a class="link" href="https://www.linux.org/threads/bin-sh-1-grub2-mkrescue-not-found-make-makefile-31-build-hello-iso-error-127.39043/"  target="_blank" rel="noopener"
    >linux.org</a>
and <a class="link" href="https://techcommunity.microsoft.com/t5/azure/i-get-the-error-quot-bin-sh-1-powershell-not-found-quot-in/m-p/2116206"  target="_blank" rel="noopener"
    >ms-community</a></p>
</li>
<li>
<p><code>mogrify</code> doesn&rsquo;t exist in /opt or /usr as the command <code>find /opt /usr -name magick</code> didn&rsquo;t return anything. <a class="link" href="https://stackoverflow.com/a/75624709/18003182"  target="_blank" rel="noopener"
    >mogrify command not found (homebrew)</a></p>
<p>mogrify only exits in:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="o">(</span>nerf<span class="o">)</span> w@homepc:~$ find ~/anaconda3 -name mogrify
</span></span><span class="line"><span class="cl">/home/w/anaconda3/pkgs/imagemagick-7.1.1_5-pl5321h211c493_1/bin/mogrify
</span></span><span class="line"><span class="cl">/home/w/anaconda3/envs/nerf/bin/mogrify
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ol>
<p>Therefore, maybe the debugger of vscode will only search in the /usr/bin (without searching the newly created virtrual envs) ?
But the interperter of VScode is indeed shown as <code>Python 3.7.12 ('nerf') ~/anaconda3/envs/nerf/bin/python</code>. I don&rsquo;t know &hellip;</p>
<p>Solutions:</p>
<ol>
<li>Creat a symbolic link <code>sudo ln -s ~/anaconda3/envs/nerf/bin/mogrify /usr/bin/mogrify</code>, then that error disappeared.</li>
<li><code>apt install imagemagick</code> works too because it creates a binary in /usr/bin, which will be found by &ldquo;/bin/sh&rdquo;.</li>
<li>(Didn&rsquo;t try) Add the <code>~/anaconda3/envs/nerf/bin</code> into <code>PATH</code> by adding the line: <code>export PATH=$PATH:/home/zichen/anaconda3/envs/nerf/bin</code> in ~/.bashrc</li>
</ol>
<h3 id="imread_v2-error">imread_v2() error
</h3><p>The version of imageio in this env is 2.28.1. And it&rsquo;s 2.19.0 in my lab server.
When reading images:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">imread</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;png&#39;</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">imageio</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">ignoregamma</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">read<span class="o">()</span> got an unexpected keyword argument <span class="s1">&#39;ignoregamma&#39;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Maybe I can remove that argument. But I chose to downgraded the package: <code>conda install imageio=2.19.0</code>.</p>
<hr>
<p>(2023-05-14)</p>
<h3 id="blas-gemm-launch-failed">Blas GEMM launch failed
</h3><p>Matrices cannot be multiplied at the 1st layer, but the input data and the coarse model both are correct.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">ret</span><span class="p">(</span><span class="n">inputs</span><span class="p">):</span> <span class="c1"># inputs:(N_rays*N_samples, 90); ret: (n_inputs, 4)</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="n">tf</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">fn</span><span class="p">(</span><span class="n">inputs</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="n">chunk</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">inputs</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">chunk</span><span class="p">)],</span> <span class="mi">0</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Error message:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">tensorflow.python.eager.core._NotOkStatusException: InternalError: Blas GEMM launch failed : a.shape<span class="o">=(</span>65536, 63<span class="o">)</span>, b.shape<span class="o">=(</span>63, 256<span class="o">)</span>, <span class="nv">m</span><span class="o">=</span>65536, <span class="nv">n</span><span class="o">=</span>256, <span class="nv">k</span><span class="o">=</span><span class="m">63</span> <span class="o">[</span>Op:MatMul<span class="o">]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ol>
<li>
<p>Reboot doesn&rsquo;t work. (Verified: nothing to with imagemagick.)</p>
</li>
<li>
<p><code>nvidia-smi</code> doesn&rsquo;t show another process (notebooks, pycharm) using GPU besides Xorg and gnome-shell.</p>
</li>
<li>
<p>Nvidia suggested 30 series card to use CUDA 11.2 or newer. <a class="link" href="https://forums.developer.nvidia.com/t/error-internal-blas-gemm-launch-failed/212936"  target="_blank" rel="noopener"
    >Error Internal: Blas GEMM launch failed</a>
<a class="link" href="https://www.zhihu.com/question/452374165"  target="_blank" rel="noopener"
    >30ç³»æ˜¾å¡ä¸å…¼å®¹?-çŸ¥ä¹</a>;
<a class="link" href="https://discourse.mozilla.org/t/problems-training-on-rtx3080/68966/7"  target="_blank" rel="noopener"
    >Problems Training on RTX3080 - DeepSpeech - Mozilla Discourse</a></p>
</li>
<li>
<p>Solution is using tf1.15 maintained by Nvidia <a class="link" href="https://www.pugetsystems.com/labs/hpc/How-To-Install-TensorFlow-1-15-for-NVIDIA-RTX30-GPUs-without-docker-or-CUDA-install-2005/"  target="_blank" rel="noopener"
    >Dr.Donald-2020-12-09</a>
,referenced by this post <a class="link" href="https://community.dataiku.com/t5/Setup-Configuration/Error-with-Tensorflow-amp-GPU/m-p/15554"  target="_blank" rel="noopener"
    >Solved: Error with Tensorflow &amp; GPU - Dataiku community</a>
And this package requires Python 3.8, but nerf is using 3.7, so there is an error: <code>error: subprocess-exited-with-error</code>, when installing <code>pip install --user nvidia-tensorflow[horovod]</code> <a class="link" href="https://github.com/NVIDIA/tensorflow/issues/15"  target="_blank" rel="noopener"
    >issue#15</a>
However, if I directly downgrade <code>conda install python=3.8</code>, there will be too many conflict error. Also modifying environment.yml and creating based on that doesn&rsquo;t work neither.</p>
<p>Base on the answer on <a class="link" href="https://stackoverflow.com/a/48594778/18003182"  target="_blank" rel="noopener"
    >SO</a>, I create a new env:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">conda create -n nerf-nvtf <span class="nv">python</span><span class="o">=</span>3.8
</span></span><span class="line"><span class="cl">conda activate nerf-nvtf
</span></span><span class="line"><span class="cl">pip install --user nvidia-pyindex
</span></span><span class="line"><span class="cl"><span class="c1"># conda install -c conda-forge openmpi # for multi-GPU</span>
</span></span><span class="line"><span class="cl"><span class="c1"># export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:$HOME/anaconda3/envs/nerf/lib/</span>
</span></span><span class="line"><span class="cl">pip install --user nvidia-tensorflow<span class="o">[</span>horovod<span class="o">]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Then I tried <code>import tensorflow</code> works.
But once I installed other packages:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">conda install numpy matplotlib imageio imageio-ffmpeg configargparse imagemagick
</span></span></code></pre></td></tr></table>
</div>
</div><p>Then <code>import tensorflow</code> cannot find the module.</p>
<p>Is this problem caused by the following modificaitons?</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">The following packages will be REMOVED:
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  libgomp-11.2.0-h1234567_1
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">The following packages will be UPDATED:
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  libgcc-ng          anaconda/pkgs/main::libgcc-ng-11.2.0-~ --&gt; anaconda/cloud/conda-forge::libgcc-ng-12.2.0-h65d4601_19 
</span></span><span class="line"><span class="cl">  libstdcxx-ng       anaconda/pkgs/main::libstdcxx-ng-11.2~ --&gt; anaconda/cloud/conda-forge::libstdcxx-ng-12.2.0-h46fd767_19 
</span></span><span class="line"><span class="cl">  zlib               anaconda/pkgs/main::zlib-1.2.13-h5eee~ --&gt; anaconda/cloud/conda-forge::zlib-1.2.13-h166bdaf_4 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">The following packages will be SUPERSEDED by a higher-priority channel:
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  _libgcc_mutex      anaconda/pkgs/main::_libgcc_mutex-0.1~ --&gt; anaconda/cloud/conda-forge::_libgcc_mutex-0.1-conda_forge 
</span></span><span class="line"><span class="cl">  _openmp_mutex      anaconda/pkgs/main::_openmp_mutex-5.1~ --&gt; anaconda/cloud/conda-forge::_openmp_mutex-4.5-2_kmp_llvm 
</span></span><span class="line"><span class="cl">  python             anaconda/pkgs/main::python-3.8.16-h7a~ --&gt; anaconda/cloud/conda-forge::python-3.8.16-0_73_pypy
</span></span></code></pre></td></tr></table>
</div>
</div><p>I tried to remove those packages, but there&rsquo;s a long waitting.</p>
<p>So I create a new environment:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">conda create -n nerf-nvtf-1.15 <span class="nv">python</span><span class="o">=</span>3.8
</span></span><span class="line"><span class="cl">conda activate nerf-nvtf-1.15
</span></span><span class="line"><span class="cl">pip install --user nvidia-pyindex
</span></span><span class="line"><span class="cl">pip install --user nvidia-tensorflow<span class="o">[</span>horovod<span class="o">]</span>
</span></span><span class="line"><span class="cl">pip install <span class="s1">&#39;imageio==2.19.0&#39;</span> configargparse
</span></span></code></pre></td></tr></table>
</div>
</div><p>Then the code can run normally.</p>
</li>
</ol>
<hr>
<h2 id="lego-ply">Lego ply
</h2><p>(2024-04-03)</p>
<p>The <code>points3d.ply</code> opened in Meshlab is a cube.</p>
<p><img src="/post/writenotes/model/nerfs/b-note-nerf_code_notes/lego_ply.jpg"
	width="450"
	height="288"
	
	loading="lazy"
	
		alt="img"
	
	
		class="gallery-image" 
		data-flex-grow="156"
		data-flex-basis="375px"
	
></p>

</section>


    <footer class="article-footer">
    
    <section class="article-tags">
        
            <a href="/tags/nerf/">NeRF</a>
        
    </section>


    </footer>


    
        <link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css"integrity="sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI&#43;WdtXRGWt2kTvGFasHpSy3SV"crossorigin="anonymous"
            ><script 
                src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"integrity="sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG&#43;vnGctmUb0ZY0l8"crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"integrity="sha384-&#43;VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4&#43;/RRE05"crossorigin="anonymous"
                defer
                >
            </script><script>
    window.addEventListener("DOMContentLoaded", () => {
	const mainArticleElement = document.querySelector(".main-article");
        renderMathInElement(mainArticleElement, {
            delimiters: [
                { left: "$$", right: "$$", display: true },
                { left: "$", right: "$", display: false },
                { left: "\\(", right: "\\)", display: false },
                { left: "\\[", right: "\\]", display: true }
            ],
            ignoredClasses: ["gist"]
        });})
</script>

    

    

    


    

    


    
    


    
    


    
    

    

    


</article>



    

    

<aside class="related-content--wrapper">
    <h2 class="section-title">Related content</h2>
    <div class="related-content">
        <div class="flex article-list--tile">
            
                
<article class="has-image">
    <a href="/post/writenotes/model/nerfs/b-note-nerf_bmild/">
        
        
            <div class="article-image">
                
                    <img src="https://github.com/bmild/nerf/raw/master/imgs/pipeline.jpg" loading="lazy" data-key="" data-hash="https://github.com/bmild/nerf/raw/master/imgs/pipeline.jpg"/>
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">read: Render - NVS | NeRF</h2>
        </div>
    </a>
</article>

            
        </div>
    </div>
</aside>

     
    
        
    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
            2020 - 
        
        2025 Zichen Wang
    </section>
    
    <section class="powerby">
        Built with <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> <br />
        Theme <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.29.0">Stack</a></b> designed by <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a>
    </section>
</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css"crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css"crossorigin="anonymous"
            >

            </main>
        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js"integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z&#43;KMkF24hUW8WePSA9HM="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

    </body>
</html>
